webpackJsonp([11],{"./web/static/js/retention.js":function(e,t,a){"use strict";(function(e){function n(){var t=e(".dimension-control .btn-group .active").val(),n=h.default.getDateRanges(),i=n.startDate,r=n.endDate,d=e(".select-box-large.institution").chosen().val(),c=e(".store-select-box").chosen().val();e.post("/retention",{storeId:c,startDate:i,endDate:r,dimension:t,institutionIds:d,_csrf:_},function(n){if(n.success)return O=o(n.data,t),s({target:"retention-data",chartType:e(".chart-type > .active").attr("name"),data:O});a.e(0).then(function(){a("./web/static/js/flash.js").default.render({payload:n})}.bind(null,a)).catch(a.oe)})}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.target,n=void 0===a?"retention-data":a,s=t.chartType,o=void 0===s?"area":s,i=t.data,r=void 0===i?[]:i,d=t.showLegend,l=void 0===d||d;c.a.chart(document.getElementsByClassName(n)[0],{chart:{type:o,backgroundColor:"transparent"},title:{text:r.length?null:"No data"},credits:{enabled:!1},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b '%y"},labels:{style:{fontSize:"13px"}}},yAxis:{title:{text:"Count"}},legend:{enabled:l},tooltip:{shared:!0,formatter:function(){var t=[],a=void 0;return t.push("<b>"+c.a.dateFormat("%e %b %Y",this.x)+"<b/><br/>"),e.each(this.points,function(e,n){switch(n.series.name){case"Day 1":a=u()(n.x).add(1,"days").format("D MMM, YYYY");break;case"Day 3":a=u()(n.x).add(3,"days").format("D MMM, YYYY");break;case"Day 7":a=u()(n.x).add(7,"days").format("D MMM, YYYY");break;case"Week 1":a=u()(n.x).add(1,"weeks").format("D MMM, YYYY");break;case"Week 2":a=u()(n.x).add(2,"weeks").format("D MMM, YYYY");break;case"Week 3":a=u()(n.x).add(3,"weeks").format("D MMM, YYYY");break;default:a=c.a.dateFormat("%e %b, %Y",n.x)}t.push(n.series.name+" ("+a+") : "+n.y)}),t.join("<br/>")}},series:r,exporting:{chartOptions:{plotOptions:{series:{dataLabels:{enabled:!1}}}},scale:3}})}function o(e,t){var a=[];if(!e.length)return a;a.push({name:"Active User",data:b()(e,function(e){return[u()(1e3*e.timestamp).utc().valueOf(),e.first]})});var n=b()(g()(e).counts,function(a,n){return{name:w[t][n],data:b()(e,function(e){return[u()(1e3*e.timestamp).utc().valueOf(),e.counts[n]]})}});return a.push(n),j()(a)}function i(){var t=e(".store-select-box").chosen().val(),n="institutions:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[n]){var s=JSON.parse(sessionStorage[n]);if(s.length)return r(s)}e.post("/institutions",{storeId:t,_csrf:_},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[n]=JSON.stringify(e.data)),r(e.data);a.e(0).then(function(){a("./web/static/js/flash.js").default.render({payload:e})}.bind(null,a)).catch(a.oe)})}function r(t){var a="";e(".select-box-large.institution option").remove(),a=Y()(t,function(e,a){return e+"<option "+(D()(t,a.id)!=-1?'selected="selected"':"")+' value="'+a.id+'">'+a.name+"</option>"},""),e(".select-box-large.institution").append(a),e(".select-box-large.institution").chosen().trigger("chosen:updated")}Object.defineProperty(t,"__esModule",{value:!0});var d=a("./node_modules/highcharts/highcharts.js"),c=a.n(d),l=a("./node_modules/moment/moment.js"),u=a.n(l),h=a("./web/static/js/datePicker.js"),f=(a("./web/static/js/common.js"),a("./node_modules/lodash/forEach.js")),m=a.n(f),p=a("./node_modules/lodash/map.js"),b=a.n(p),v=a("./node_modules/lodash/head.js"),g=a.n(v),y=a("./node_modules/lodash/flatten.js"),j=a.n(y),x=a("./node_modules/lodash/reduce.js"),Y=a.n(x),k=a("./node_modules/lodash/indexOf.js"),D=a.n(k),M=a("./node_modules/chosen-npm/public/chosen.jquery.js");a.n(M),a("./node_modules/highcharts/modules/exporting.js")(c.a),e('.chart-type > [data-toggle="tooltip"]').tooltip(),e(".store-select-box").children().first().attr("selected","selected");var _=e("input[name=_csrf]").val(),w={day:["Day 1","Day 3","Day 7"],week:["Week 1","Week 2","Week 3"]},O=void 0;m()([".store-select-box",".select-box-large.institution"],function(t){e(t).chosen({disable_search:!0})}),n(),i(),h.default.setDatePicker('input[name="daterange"]'),e(".dimension-control button").on("click",function(t){t.preventDefault(),e(".dimension-control button").removeClass("active"),e(this).addClass("active")}),e(".btnApply").on("click",function(){n()}),e(".chart-type button").on("click",function(){return e(this).siblings().removeClass("active"),e(this).addClass("active"),s({target:"retention-data",chartType:e(this).attr("name"),data:O})}),e(".store-select-box").chosen().change(function(){i()})}).call(t,a("./node_modules/jquery/dist/jquery.js"))}},["./web/static/js/retention.js"]);