webpackJsonp([1],{"./node_modules/highcharts/modules/funnel.js":function(e,o){!function(o){"object"==typeof e&&e.exports?e.exports=o:o(Highcharts)}(function(e){!function(e){var o=e.seriesType,t=e.seriesTypes,n=e.noop,s=e.each;o("funnel","pie",{animation:!1,center:["50%","50%"],width:"90%",neckWidth:"30%",height:"100%",neckHeight:"25%",reversed:!1,size:!0,dataLabels:{connectorWidth:1},states:{select:{color:"#cccccc",borderColor:"#000000",shadow:!1}}},{animate:n,translate:function(){var e,o,t,a,r,i,l,d,u,c,h,f=function(e,o){return/%$/.test(e)?o*parseInt(e,10)/100:parseInt(e,10)},p=0,b=this.chart,g=this.options,m=g.reversed,v=g.ignoreHiddenPoint,y=b.plotWidth,b=b.plotHeight,_=0,j=g.center,k=f(j[0],y),w=f(j[1],b),x=f(g.width,y),A=f(g.height,b),S=f(g.neckWidth,y),C=f(g.neckHeight,b),F=w-A/2+A-C,f=this.data,O="left"===g.dataLabels.position?1:0;this.getWidthAt=o=function(e){var o=w-A/2;return e>F||A===C?S:S+(x-S)*(1-(e-o)/(A-C))},this.getX=function(e,t){return k+(t?-1:1)*(o(m?2*w-e:e)/2+g.dataLabels.distance)},this.center=[k,w,A],this.centerX=k,s(f,function(e){v&&!1===e.visible||(p+=e.y)}),s(f,function(s){h=null,a=p?s.y/p:0,i=w-A/2+_*A,u=i+a*A,e=o(i),r=k-e/2,l=r+e,e=o(u),d=k-e/2,c=d+e,i>F?(r=d=k-S/2,l=c=k+S/2):u>F&&(h=u,e=o(F),d=k-e/2,c=d+e,u=F),m&&(i=2*w-i,u=2*w-u,h=h?2*w-h:null),t=["M",r,i,"L",l,i,c,u],h&&t.push(c,h,d,h),t.push(d,u,"Z"),s.shapeType="path",s.shapeArgs={d:t},s.percentage=100*a,s.plotX=k,s.plotY=(i+(h||u))/2,s.tooltipPos=[k,s.plotY],s.slice=n,s.half=O,v&&!1===s.visible||(_+=a)})},drawPoints:t.column.prototype.drawPoints,sortByAngle:function(e){e.sort(function(e,o){return e.plotY-o.plotY})},drawDataLabels:function(){var e,o,n,s,a,r=this.data,i=this.options.dataLabels.distance,l=r.length;for(this.center[2]-=2*i;l--;)n=r[l],o=(e=n.half)?1:-1,a=n.plotY,s=this.getX(a,e),n.labelPos=[0,a,s+(i-5)*o,a,s+i*o,a,e?"right":"left",0];t.pie.prototype.drawDataLabels.call(this)}}),o("pyramid","funnel",{neckWidth:"0%",neckHeight:"0%",reversed:!0})}(e)})},"./node_modules/lodash/_asciiToArray.js":function(e,o){function t(e){return e.split("")}e.exports=t},"./node_modules/lodash/_castSlice.js":function(e,o,t){function n(e,o,t){var n=e.length;return t=void 0===t?n:t,!o&&t>=n?e:s(e,o,t)}var s=t("./node_modules/lodash/_baseSlice.js");e.exports=n},"./node_modules/lodash/_createCaseFirst.js":function(e,o,t){function n(e){return function(o){o=i(o);var t=a(o)?r(o):void 0,n=t?t[0]:o.charAt(0),l=t?s(t,1).join(""):o.slice(1);return n[e]()+l}}var s=t("./node_modules/lodash/_castSlice.js"),a=t("./node_modules/lodash/_hasUnicode.js"),r=t("./node_modules/lodash/_stringToArray.js"),i=t("./node_modules/lodash/toString.js");e.exports=n},"./node_modules/lodash/_hasUnicode.js":function(e,o){function t(e){return u.test(e)}var n="\\ud800-\\udfff",s="\\u0300-\\u036f",a="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=s+a+r,l="\\ufe0e\\ufe0f",d="\\u200d",u=RegExp("["+d+n+i+l+"]");e.exports=t},"./node_modules/lodash/_stringToArray.js":function(e,o,t){function n(e){return a(e)?r(e):s(e)}var s=t("./node_modules/lodash/_asciiToArray.js"),a=t("./node_modules/lodash/_hasUnicode.js"),r=t("./node_modules/lodash/_unicodeToArray.js");e.exports=n},"./node_modules/lodash/_unicodeToArray.js":function(e,o){function t(e){return e.match(k)||[]}var n="\\ud800-\\udfff",s="\\u0300-\\u036f",a="\\ufe20-\\ufe2f",r="\\u20d0-\\u20ff",i=s+a+r,l="\\ufe0e\\ufe0f",d="["+n+"]",u="["+i+"]",c="\\ud83c[\\udffb-\\udfff]",h="(?:"+u+"|"+c+")",f="[^"+n+"]",p="(?:\\ud83c[\\udde6-\\uddff]){2}",b="[\\ud800-\\udbff][\\udc00-\\udfff]",g="\\u200d",m=h+"?",v="["+l+"]?",y="(?:"+g+"(?:"+[f,p,b].join("|")+")"+v+m+")*",_=v+m+y,j="(?:"+[f+u+"?",u,p,b,d].join("|")+")",k=RegExp(c+"(?="+c+")|"+j+_,"g");e.exports=t},"./node_modules/lodash/startCase.js":function(e,o,t){var n=t("./node_modules/lodash/_createCompounder.js"),s=t("./node_modules/lodash/upperFirst.js"),a=n(function(e,o,t){return e+(t?" ":"")+s(o)});e.exports=a},"./node_modules/lodash/upperFirst.js":function(e,o,t){var n=t("./node_modules/lodash/_createCaseFirst.js"),s=n("toUpperCase");e.exports=s},"./web/static/js/funnel.js":function(e,o,t){"use strict";(function(e){function n(o,n){var a=[],r="filters:"+n+":"+o;return o?"undefined"!=typeof Storage&&void 0!==sessionStorage[r]&&(a=JSON.parse(sessionStorage[r]),a.length)?s(a):void e.post("/events/filters",{storeId:[n],type:o,_csrf:O},function(e){if(e.success)return a=e.data.filters,"undefined"!=typeof Storage&&(sessionStorage[r]=JSON.stringify(a)),s(a);t.e(0).then(function(){t("./web/static/js/flash.js").default.render({payload:e})}.bind(null,t)).catch(t.oe)}):(e(".select-box-large.filters option").remove(),e(".row.filter-val-row").hide())}function s(o){e(".select-box-large.filters option").remove();var t=v()(o,function(e,o){return e+'<option value="'+o+'">'+o+"</option>"},"");return e(".select-box-large.filters").append(t),e(".select-box-large.filters").chosen().trigger("chosen:updated"),e(".row.filter-val-row").show()}function a(){var o=e(".funnel-select-box").chosen().val(),n=S[o],s=h.default.getDateRanges(),a=s.startDate,l=s.endDate,d=e(".select-box-large.filter-by").chosen().val(),u=e(".select-box-large.filters").chosen().val(),c=e(".select-box-large.institution").chosen().val(),f=void 0,p=void 0,b=void 0;switch(d){case"device_platform":p=u;break;case"app_version":b=u}e(".funnel-activity-report .box-title").html(F[o].heading),e(".funnel-activity-report .box-title-help").attr("data-original-title",F[o].tooltip),e("ul.sidebar-menu ."+C[0]+" li").removeClass("active"),e("ul.sidebar-menu ."+C[0]+"-"+o).addClass("active"),e.post("/funnel",{storeId:e(".store-select-box").chosen().val(),startDate:a,endDate:l,steps:n,platform:p,appVersion:b,institutionIds:c,_csrf:O},function(e){if(e.success)return f=i(e.data,o,n),r("book-funnel",f,x()(o));t.e(0).then(function(){t("./web/static/js/flash.js").default.render({payload:e})}.bind(null,t)).catch(t.oe)})}function r(e,o,t){c.a.chart(document.getElementsByClassName(e)[0],{chart:{type:"funnel",backgroundColor:"transparent",marginRight:130},credits:{enabled:!1},title:{text:o.length?"Unique Users":"No data",x:-50},plotOptions:{series:{dataLabels:{enabled:!0,distance:0,format:"<b>{point.name}</b> ({point.y:,.0f})",softConnector:!0},neckWidth:"30%",neckHeight:"25%"}},legend:{enabled:!1},series:o,exporting:{chartOptions:{plotOptions:{series:{dataLabels:{enabled:!1}}}},scale:3},navigation:{buttonOptions:{x:-10}}})}function i(e,o,t){return _()(e.counts)?[{name:x()(o),data:g()(t,function(o,t){return[F[o],e.counts[t]]})}]:[]}function l(o){var n="institutions:"+o;if("undefined"!=typeof Storage&&void 0!==sessionStorage[n]){var s=JSON.parse(sessionStorage[n]);if(s.length)return d(s)}e.post("/institutions",{storeId:o,_csrf:O},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[n]=JSON.stringify(e.data)),d(e.data);t.e(0).then(function(){t("./web/static/js/flash.js").default.render({payload:e})}.bind(null,t)).catch(t.oe)})}function d(o){var t="";e(".select-box-large.institution option").remove(),t=v()(o,function(e,t){return e+"<option "+(k()(o,t.id)!=-1?'selected="selected"':"")+' value="'+t.id+'">'+t.name+"</option>"},""),e(".select-box-large.institution").append(t),e(".select-box-large.institution").chosen().trigger("chosen:updated")}Object.defineProperty(o,"__esModule",{value:!0});var u=t("./node_modules/highcharts/highcharts.js"),c=t.n(u),h=t("./web/static/js/datePicker.js"),f=(t("./web/static/js/common.js"),t("./node_modules/lodash/forEach.js")),p=t.n(f),b=t("./node_modules/lodash/map.js"),g=t.n(b),m=t("./node_modules/lodash/reduce.js"),v=t.n(m),y=t("./node_modules/lodash/head.js"),_=t.n(y),j=t("./node_modules/lodash/indexOf.js"),k=t.n(j),w=t("./node_modules/lodash/startCase.js"),x=t.n(w),A=t("./node_modules/chosen-npm/public/chosen.jquery.js");t.n(A),t("./node_modules/highcharts/modules/exporting.js")(c.a),t("./node_modules/highcharts/modules/funnel.js")(c.a);var S={notesFunnel:["bookDownloadComplete","bookOpen","noteAdd"],highlightsFunnel:["bookDownloadComplete","bookOpen","highlightAdd"],bookmarksFunnel:["bookDownloadComplete","bookOpen","bookmarkAdd"],searchFunnel:["bookDownloadComplete","bookOpen","searchResult"]},C=window.location.pathname.substring(1).split("/"),F={bookDownloadComplete:"Book Downloaded",bookOpen:"Books Opened",noteAdd:"Notes Added",bookmarkAdd:"Bookmarks Added",highlightAdd:"Highlights Added",searchResult:"Book Searched",notesFunnel:{heading:"Notes Funnel",tooltip:"The chart display, in progressively decreasing proportions, the number of users who downloaded a book followed by the number of users who opened a book and finally the number of users who added a note"},bookmarksFunnel:{heading:"Bookmarks Funnel",tooltip:"The chart display, in progressively decreasing proportions, the number of users who downloaded a book followed by the number of users who opened a book and finally the number of users who added a bookmark"},highlightsFunnel:{heading:"Highlights Funnel",tooltip:"The chart display, in progressively decreasing proportions, the number of users who downloaded a book followed by the number of users who opened a book and finally the number of users who added a highlight"},searchFunnel:{heading:"Search Funnel",tooltip:"The chart display, in progressively decreasing proportions, the number of users who downloaded a book followed by the number of users who opened a book and finally the number of users who performed a search"}},O=e("input[name=_csrf]").val();p()([".store-select-box",".funnel-select-box",".select-box-large.filter-by",".select-box-large.filters",".select-box-large.institution"],function(o){e(o).chosen({disable_search:!0})}),e(".select-box-large.filter-by").chosen().change(function(){n(e(this).val(),e(".store-select-box").chosen().val())}),e(".store-select-box").chosen().change(function(){n(e(".select-box-large.filter-by").chosen().val(),e(this).val()),l(e(".store-select-box").chosen().val())}),n(e(".select-box-large.filter-by").chosen().val(),e(".store-select-box").chosen().val()),e(".btnApply").on("click",function(){a()}),h.default.setDatePicker('input[name="daterange"]'),e(".funnel-activity-report .box-title").html(F[e(".funnel-select-box").chosen().val()].heading),e(".funnel-activity-report .box-title-help").attr("data-original-title",F[e(".funnel-select-box").chosen().val()].tooltip),a(),l(e(".store-select-box").chosen().val())}).call(o,t("./node_modules/jquery/dist/jquery.js"))}},["./web/static/js/funnel.js"]);