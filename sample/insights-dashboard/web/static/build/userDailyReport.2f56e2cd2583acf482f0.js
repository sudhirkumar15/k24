webpackJsonp([3],{"./web/static/js/userDailyReport.js":function(e,t,n){"use strict";(function(e){function s(t,s,a){var i=[],r="filters:"+s+":"+t;return t?"undefined"!=typeof Storage&&void 0!==sessionStorage[r]&&(i=JSON.parse(sessionStorage[r]),i.length)?o(i,a):void e.post("/events/filters",{storeId:[s],type:t,_csrf:J},function(e){if(e.success)return i=e.data.filters,"undefined"!=typeof Storage&&(sessionStorage[r]=JSON.stringify(i)),o(i,a);n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)}):(e(".select-box-large.filters option").remove(),e(".row.filter-val-row").hide())}function o(t,n){e(".select-box-large.filters option").remove();var s=_()(t,function(e,t){return e+"<option "+(I()(n,t)!=-1?'selected="selected"':"")+' value="'+t+'">'+t+"</option>"},"");e(".select-box-large.filters").append(s),e(".select-box-large.filters").chosen().trigger("chosen:updated"),e(".row.filter-val-row").show()}function a(t){t||(t=e(".store-select-box").chosen().val());var s="institutions:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[s]){var o=JSON.parse(sessionStorage[s]);o.length&&i(o)}e.post("/institutions",{storeId:t,_csrf:J},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[s]=JSON.stringify(e.data)),i(e.data);n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)})}function i(t){var n=H.institutionIds,s="";e(".select-box-large.institution option").remove(),s=_()(t,function(e,t){return e+"<option "+(I()(n,t.id)!=-1?'selected="selected"':"")+' value="'+t.id+'">'+t.name+"</option>"},""),e(".select-box-large.institution").append(s),e(".select-box-large.institution").chosen().trigger("chosen:updated")}function r(t,n,s){e(".flash-msgs").remove();var o=x.default.getDateRanges(),a=o.startDate,i=o.endDate,r=e(".select-box-large.filter-by").chosen().val(),c=e(".select-box-large.filters").chosen().val();t||(t=e(".store-select-box").chosen().val()),n||(n=e(".event-type").chosen().val());var u=void 0,h=void 0,p=void 0,f=void 0;switch(r){case"device_platform":u=c;break;case"device_make":h=c;break;case"device_model":p=c;break;case"app_version":f=c}switch(n){case"activeUsers":case"newUsers":l(t,a,i,s,n,u,h,p,f);break;default:d(t,a,i,n,s,u,h,p,f)}e(".user-daily-report .box-title").html(R[n].heading),e(".user-daily-report .box-title-help").attr("data-original-title",R[n].tooltip),e("ul.sidebar-menu ."+B[0]+"-"+B[1]+" li").removeClass("active"),e("ul.sidebar-menu ."+B[0]+"-"+B[1]+"-"+n).addClass("active")}function l(t,s,o,a,i,r,l,d,h){e.post("/sessions",{storeId:[t],dimension:"day",startDate:s,endDate:o,institutionIds:a,platforms:r,deviceMakes:l,deviceModels:d,appVersions:h,_csrf:J},function(s){if(s.success)return E=u(s.data,i),p(E.tabular,t,i,E.caption),f(),c(E.chart,e(".chart-type > .active").attr("name"));n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:s})}.bind(null,n)).catch(n.oe)})}function d(t,s,o,a,i,r,l,d,u){e.post("/users/events/summary",{storeId:t,startDate:s,endDate:o,events:[a],institutionIds:i,platforms:r,deviceMakes:l,deviceModels:d,appVersions:u,_csrf:J},function(s){if(s.success)return E=h(s.data,a),E.caption="User Count",p(E.tabular,t,a,E.caption),f(),c(E.chart,e(".chart-type > .active").attr("name"));n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:s})}.bind(null,n)).catch(n.oe)})}function c(e,t){v.a.chart(document.getElementsByClassName("daily-users")[0],{chart:{type:t,backgroundColor:"transparent",zoomType:"xy"},credits:{enabled:!1},title:{text:e.length?null:"No data"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b '%y"},labels:{style:{fontSize:"13px"}}},plotOptions:{series:{stacking:"normal"}},yAxis:{title:{text:"User Count"}},legend:{enabled:!1},tooltip:{formatter:function(){return"Date : "+v.a.dateFormat("%e %b, %Y",this.x)+"<br />"+this.series.name+"<br /> count : <b>"+this.y+"</b>"}},series:e,exporting:{chartOptions:{plotOptions:{series:{dataLabels:{enabled:!1}}}},scale:3}})}function u(e,t){var n={tabular:[],chart:[],caption:"User Count"};if(!e.length)return n;var s="newusers";return(t="activeUsers")&&(s="users"),n.tabular=U()(e,function(e){return{date:w()(1e3*e.timestamp).format("DD MMM YYYY"),count:e[s]}}),e=O()(e,0,10),n.chart=[{name:"Activity : "+t,data:U()(e,function(e){return[w()(1e3*e.timestamp).utc().valueOf(),e[s]]})}],n}function h(e,t){var n={tabular:[],chart:[]};return e.length?(n.tabular=U()(e,function(e){return{date:w()(1e3*e.timestamp).format("DD MMM YYYY"),count:e.count}}),n.chart=[{name:"Activity : "+t,data:U()(e,function(e){return[w()(1e3*e.timestamp).utc().valueOf(),e.count]})}],n):n}function p(t,n,s,o){e(".userdata").html(N()({rows:t,storeId:n,event:s,tableHeader:o,showLink:!1})),e(".report-list").DataTable({responsive:!0,lengthChange:!0})}function f(){var t={report:E.tabular};e('form[name="export"] input[name="export"]').val(JSON.stringify(t))}Object.defineProperty(t,"__esModule",{value:!0});var b=n("./node_modules/highcharts/highcharts.js"),v=n.n(b),m=n("./node_modules/qs/lib/index.js"),g=n.n(m),y=n("./node_modules/moment/moment.js"),w=n.n(y),x=n("./web/static/js/datePicker.js"),j=n("./node_modules/lodash/forEach.js"),k=n.n(j),C=n("./node_modules/lodash/reduce.js"),_=n.n(C),D=n("./node_modules/lodash/map.js"),U=n.n(D),S=n("./node_modules/lodash/slice.js"),O=n.n(S),M=n("./node_modules/lodash/indexOf.js"),I=n.n(M),q=(n("./web/static/js/common.js"),n("./node_modules/chosen-npm/public/chosen.jquery.js")),A=(n.n(q),n("./web/static/views/partials/default/tableUserDaily.hbs")),N=n.n(A),Y=n("./node_modules/datatables.net-responsive-bs/js/responsive.bootstrap.js");n.n(Y),n("./node_modules/highcharts/modules/exporting.js")(v.a),e('.chart-type > [data-toggle="tooltip"]').tooltip();var J=e("input[name=_csrf]").val(),H=g.a.parse(window.location.search.substring(1)),B=window.location.pathname.substring(1).split("/"),E={},R={bookDownloadComplete:{heading:"User Count - Book Download",tooltip:"Count of unique users who downloaded books within the speficied duration"},bookOpen:{heading:"User Count - Book Open",tooltip:"Count of unique users who opened books within the speficied duration"},noteAdd:{heading:"User Count - Notes",tooltip:"Count of unique users who added notes within the speficied duration"},bookmarkAdd:{heading:"User Count - Bookmarks",tooltip:"Count of unique users who added bookmarks within the speficied duration"},highlightAdd:{heading:"User Count - Highlights",tooltip:"Count of unique users who added highlights within the speficied duration"},searchResult:{heading:"User Count - Searches",tooltip:"Count of unique users who performed a search within the speficied duration"},newUsers:{heading:"New User Count",tooltip:"Count of new users who performed any activity on books on any givin day within the specified duration"},activeUsers:{heading:"Active User Count",tooltip:"Count of active users who performed any activity on books on any givin day within the specified duration"}};k()([".store-select-box",".select-box-large.institution",".select-box-large.event-type"],function(t){e(t).chosen({disable_search:!0})}),e(".store-select-box").chosen().change(function(){a()}),x.default.setDatePicker('input[name="daterange"]'),e(".user-daily-report .box-title").html(R[e(".select-box-large.event-type").chosen().val()].heading),e(".user-daily-report .box-title-help").attr("data-original-title",R[e(".select-box-large.event-type").chosen().val()].tooltip),e(".btnApply").on("click",function(){r(e(".store-select-box").chosen().val(),e(".select-box-large.event-type").chosen().val(),e(".select-box-large.institution").chosen().val())}),e(".chart-type button").on("click",function(){e(this).siblings().removeClass("active"),e(this).addClass("active"),c(E.chart,e(this).attr("name"))}),a(H.storeId),r(H.storeId,H.event,H.institutionIds),s(e(".select-box-large.filter-by").chosen().val(),e(".store-select-box").chosen().val(),H.filterVals),e(".select-box-large.filter-by").chosen().change(function(){s(e(this).val(),e(".store-select-box").chosen().val())})}).call(t,n("./node_modules/jquery/dist/jquery.js"))},"./web/static/views/partials/default/tableUserDaily.hbs":function(e,t,n){var s=n("./node_modules/handlebars/runtime.js");e.exports=(s.default||s).template({1:function(e,t,n,s,o){var a,i=null!=t?t:{},r=n.helperMissing,l="function",d=e.escapeExpression;return"            <tr>\n                <td>"+d((a=null!=(a=n.date||(null!=t?t.date:t))?a:r,typeof a===l?a.call(i,{name:"date",hash:{},data:o}):a))+"</td>\n                <td>"+d((a=null!=(a=n.count||(null!=t?t.count:t))?a:r,typeof a===l?a.call(i,{name:"count",hash:{},data:o}):a))+"</td>\n            </tr>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,s,o){var a,i,r=null!=t?t:{};return'<table class="table table-bordered table-striped report-list">\n    <thead>\n        <th>Date</th>\n        <th>'+e.escapeExpression((i=null!=(i=n.tableHeader||(null!=t?t.tableHeader:t))?i:n.helperMissing,"function"==typeof i?i.call(r,{name:"tableHeader",hash:{},data:o}):i))+"</th>\n    </thead>\n    <tbody>\n"+(null!=(a=n.each.call(r,null!=t?t.rows:t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o}))?a:"")+"    </tbody>\n</table>\n"},useData:!0})}},["./web/static/js/userDailyReport.js"]);