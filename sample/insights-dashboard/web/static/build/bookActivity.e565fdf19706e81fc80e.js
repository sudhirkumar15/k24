webpackJsonp([9],{"./web/static/js/bookActivity.js":function(e,t,o){"use strict";(function(e){function a(t,a,n){var i=[],r="filters:"+a+":"+t;return t?"undefined"!=typeof Storage&&void 0!==sessionStorage[r]&&(i=JSON.parse(sessionStorage[r]),i.length)?s(i,n):void e.post("/events/filters",{storeId:[a],type:t,_csrf:P},function(e){if(e.success)return i=e.data.filters,"undefined"!=typeof Storage&&(sessionStorage[r]=JSON.stringify(i)),s(i,n);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:e})}.bind(null,o)).catch(o.oe)}):(e(".select-box-large.filters option").remove(),e(".row.filter-val-row").hide())}function n(t){t||(t=e(".store-select-box").chosen().val());var a="institutions:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[a]){var n=JSON.parse(sessionStorage[a]);if(n.length)return i(n)}e.post("/institutions",{storeId:t,_csrf:P},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[a]=JSON.stringify(e.data)),i(e.data);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:e})}.bind(null,o)).catch(o.oe)})}function s(t,o){e(".select-box-large.filters option").remove();var a=T()(t,function(e,t){return e+"<option "+(O()(o,t)!=-1?'selected="selected"':"")+' value="'+t+'">'+t+"</option>"},"");return e(".select-box-large.filters").append(a),e(".select-box-large.filters").chosen().trigger("chosen:updated"),e(".row.filter-val-row").show()}function i(t){var o=H.institutionIds,a="";e(".select-box-large.institution option").remove(),a=T()(t,function(e,t){return e+"<option "+(O()(o,t.id)!=-1?'selected="selected"':"")+' value="'+t.id+'">'+t.name+"</option>"},""),e(".select-box-large.institution").append(a),e(".select-box-large.institution").chosen().trigger("chosen:updated")}function r(t){t||(t=e(".store-select-box").chosen().val());var a="books:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[a]){var n=JSON.parse(sessionStorage[a]);if(n.length)return l(n)}e.post("/books",{storeId:t,_csrf:P},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[a]=JSON.stringify(e.data)),l(e.data);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:e})}.bind(null,o)).catch(o.oe)})}function l(t){var o=H.productIds,a="";e(".select-box-large.book option").remove(),a=T()(t,function(e,t){return e+"<option "+(O()(o,t.id)!=-1?'selected="selected"':"")+' value="'+t.id+'">'+t.name+"</option>"},""),e(".select-box-large.book").append(a),e(".select-box-large.book").chosen().trigger("chosen:updated")}function c(t,o,a,n){e(".flash-msgs").remove(),o||(o=e(".event-type").chosen().val());var s=w.default.getDateRanges(),i=s.startDate,r=s.endDate,l=e(".select-box-large.filter-by").chosen().val(),c=e(".select-box-large.filters").chosen().val(),h=void 0,p=void 0,f=void 0,b=void 0;switch(l){case"device_platform":h=c;break;case"device_make":p=c;break;case"device_model":f=c;break;case"app_version":b=c}switch(o){case"timespent":u(t,i,r,a,n,h,p,f,b);break;default:d(t,i,r,o,a,n,h,p,f,b)}e(".book-activity-chart .box-title").html(z[o].heading),e(".book-activity-chart .box-title-help").attr("data-original-title",z[o].tooltip),e("ul.sidebar-menu ."+J[0]+"-"+J[1]+" li").removeClass("active"),e("ul.sidebar-menu ."+J[0]+"-"+J[1]+"-"+o).addClass("active")}function d(t,a,n,s,i,r,l,c,d,u){t||(t=e(".store-select-box").chosen().val()),s||(s=e(".event-type").chosen().val()),e.post("/books/top",{storeId:t,startDate:a,endDate:n,events:[s],institutionIds:i,productIds:r,limit:100,platforms:l,deviceMakes:c,deviceModels:d,appVersions:u,_csrf:P},function(a){if(a.success){var n=!0;switch(q=f(a.data,s),s){case"bookDownloadComplete":case"bookOpen":case"searchResult":n=!1}return m(q.tabular,t,s,"Activity Count",n),v("/books/activity/export"),h(q.chart,e(".chart-type > .active").attr("name"))}o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:a})}.bind(null,o)).catch(o.oe)})}function u(t,a,n,s,i,r,l,c,d){t||(t=e(".store-select-box").chosen().val()),e.post("/books/timespent",{storeId:t,startDate:a,endDate:n,institutionIds:s,productIds:i,limit:100,platforms:r,deviceMakes:l,deviceModels:c,appVersions:d,_csrf:P},function(a){if(a.success)return q=b(a.data),m(q.tabular,t,"timespent","Duration in HH:MM:SS"),v("/books/timespent/export"),p(q.chart,e(".chart-type > .active").attr("name"));o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:a})}.bind(null,o)).catch(o.oe)})}function h(e,t){y.a.chart(document.getElementsByClassName("top-books")[0],{chart:{type:t,backgroundColor:"transparent",zoomType:"xy"},credits:{enabled:!1},title:{text:e.length?null:"No data"},xAxis:{type:"category",labels:{style:{fontSize:"13px"}}},plotOptions:{series:{stacking:"normal"}},yAxis:{title:{text:"Activity count"}},legend:{enabled:!1},tooltip:{formatter:function(){return"Name : "+this.point.name+"<br />"+this.series.name+"<br /> count : <b>"+this.y+"</b>"}},series:e,exporting:{chartOptions:{plotOptions:{series:{dataLabels:{enabled:!1}}}},scale:3}})}function p(e,t){y.a.chart(document.getElementsByClassName("top-books")[0],{chart:{type:t,backgroundColor:"transparent",zoomType:"xy"},credits:{enabled:!1},title:{text:e.length?null:"No data"},xAxis:{type:"category",labels:{style:{fontSize:"13px"}}},yAxis:{title:{text:"Hours"},type:"linear",labels:{formatter:function(){var e=this.value;this.value=1e3*e;var t=e/60|0;e-=60*t;var o=t/60|0;return t-=60*o,o}},startOnTick:!1,showFirstLabel:!1},legend:{enabled:!1},tooltip:{shared:!1,formatter:function(){var e=parseInt(this.y/3600)%24,t=parseInt(this.y/60)%60,o=this.y%60;return e=e<10?"0"+e:e,t=t<10?"0"+t:t,o=o<10?"0"+o:o,"Name: "+this.point.name+" <br /> "+this.series.name+" : <b> "+e+":"+t+":"+o}},series:e})}function f(e,t){var o={tabular:[],chart:[]};return e.length?(o.tabular=e,e=A()(e,0,10),o.chart=[{name:"Activity : "+t,data:B()(e,function(e){return[e.name?e.name+" ("+e.format+")":e.id+" ("+e.format+")",e.count]})}],o):o}function b(e){var t={tabular:[],chart:[]};return e.length?(t.tabular=B()(e,function(e){var t=parseInt(e.duration/3600)%24,o=parseInt(e.duration/60)%60,a=e.duration%60;return t=t<10?"0"+t:t,o=o<10?"0"+o:o,a=a<10?"0"+a:a,e.count=t+":"+o+":"+a,e}),e=A()(e,0,10),t.chart=[{name:"Time spent",data:B()(e,function(e){return[e.name?e.name+" ("+e.format+")":e.id+" ("+e.format+")",e.duration]})}],t):t}function m(t,o,a,n){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];e(".bookdata").html(V()({rows:t,storeId:o,event:a,tableHeader:n,showLink:s})),e(".report-list").DataTable({responsive:!0,lengthChange:!0,order:[[4,"desc"]]})}function v(t){var o={report:q.tabular};e('form[name="export"]').attr("action",t),e('form[name="export"] input[name="export"]').val(JSON.stringify(o))}Object.defineProperty(t,"__esModule",{value:!0});var g=o("./node_modules/highcharts/highcharts.js"),y=o.n(g),k=o("./node_modules/qs/lib/index.js"),x=o.n(k),w=o("./web/static/js/datePicker.js"),j=o("./node_modules/lodash/forEach.js"),S=o.n(j),I=o("./node_modules/lodash/reduce.js"),T=o.n(I),_=o("./node_modules/lodash/map.js"),B=o.n(_),D=o("./node_modules/lodash/slice.js"),A=o.n(D),C=o("./node_modules/lodash/indexOf.js"),O=o.n(C),N=(o("./web/static/js/common.js"),o("./node_modules/chosen-npm/public/chosen.jquery.js")),M=(o.n(N),o("./web/static/views/partials/default/tableBooks.hbs")),V=o.n(M),E=o("./node_modules/datatables.net-responsive-bs/js/responsive.bootstrap.js");o.n(E),o("./node_modules/highcharts/modules/exporting.js")(y.a),e('.chart-type > [data-toggle="tooltip"]').tooltip();var P=e("input[name=_csrf]").val(),H=x.a.parse(window.location.search.substring(1)),J=window.location.pathname.substring(1).split("/"),q={chart:[],tabular:[],caption:"Count"},z={bookDownloadComplete:{heading:"Top Books - Book Download",tooltip:"The ten, most frequently downloaded books, and their count"},bookOpen:{heading:"Top Books - Book Open",tooltip:"The ten, most frequently opened books, and their count"},noteAdd:{heading:"Top Books - Notes",tooltip:"Ten books for which maximum number of notes were created, and their count"},bookmarkAdd:{heading:"Top Books - Bookmarks",tooltip:"Ten books for which maximum number of bookmarks were created and their count"},highlightAdd:{heading:"Top Books - Highlights",tooltip:"Ten titles for which maximum number of highlights were created and their count"},searchResult:{heading:"Top Books - Searches",tooltip:"The ten, most frequently searched books, and their count"},pageView:{heading:"Top Books - Page Views (PDF)",tooltip:"Ten books for which maximum number of pages were viewed, and their count. Page views are for PDF books"},contentView:{heading:"Top Books - Content Views (EPUB)",tooltip:"Ten books for which maximum content was viewed, and their count. Content views are for EPUB books"},timespent:{heading:"Top Books - Time Spent",tooltip:"Ten books on which users have spent maximum time. The time is displayed in hours"}};S()([".store-select-box",".select-box-large.institution",".select-box-large.event-type"],function(t){e(t).chosen({disable_search:!0})}),e(".store-select-box").chosen().change(function(){n(),r(),a(e(".select-box-large.filter-by").chosen().val(),e(this).val())}),w.default.setDatePicker('input[name="daterange"]'),e(".book-activity-report .box-title").html(z[e(".select-box-large.event-type").chosen().val()].heading),e(".book-activity-report .box-title-help").attr("data-original-title",z[e(".select-box-large.event-type").chosen().val()].tooltip),e("body").on("click",".book-id",function(t){t.preventDefault();var o=e(".store-select-box").chosen().val(),a=e(".select-box-large.institution").chosen().val(),n=e(".select-box-large.book").chosen().val(),s=e(".select-box-large.filter-by").chosen().val(),i=e(".select-box-large.filters").chosen().val(),r=e(this).data("event"),l=e(this).data("format"),c=e(this).data("bookid"),d={storeId:o,institutionIds:a,productIds:n,bookId:c,event:r,format:l,filterType:s,filterVals:i};switch(r){case"pageView":case"bookmarkAdd":case"noteAdd":case"highlightAdd":case"contentView":case"contentScroll":window.location="/books/heatmap/"+l+"?"+x.a.stringify(d)}}),a(e(".select-box-large.filter-by").chosen().val(),e(".store-select-box").chosen().val(),H.filterVals),e(".btnApply").on("click",function(){c(e(".store-select-box").chosen().val(),e(".select-box-large.event-type").chosen().val(),e(".select-box-large.institution").chosen().val(),e(".select-box-large.book").chosen().val())}),e(".select-box-large.filter-by").chosen().change(function(){a(e(this).val(),e(".store-select-box").chosen().val())}),e(".chart-type button").on("click",function(){e(this).siblings().removeClass("active"),e(this).addClass("active"),h(q.chart,e(this).attr("name"))}),n(H.storeId),r(H.storeId),c(H.storeId,H.event,H.institutionIds,H.productIds)}).call(t,o("./node_modules/jquery/dist/jquery.js"))},"./web/static/views/partials/default/tableBooks.hbs":function(e,t,o){var a=o("./node_modules/handlebars/runtime.js");e.exports=(a.default||a).template({1:function(e,t,o,a,n,s,i){var r,l,c=null!=t?t:{},d=o.helperMissing,u="function",h=e.escapeExpression;return"            <tr>\n"+(null!=(r=o.if.call(c,null!=i[1]?i[1].showLink:i[1],{name:"if",hash:{},fn:e.program(2,n,0,s,i),inverse:e.program(4,n,0,s,i),data:n}))?r:"")+"                <td>"+h((l=null!=(l=o.name||(null!=t?t.name:t))?l:d,typeof l===u?l.call(c,{name:"name",hash:{},data:n}):l))+"</td>\n                <td>"+h((l=null!=(l=o.code||(null!=t?t.code:t))?l:d,typeof l===u?l.call(c,{name:"code",hash:{},data:n}):l))+"</td>\n                <td>"+h((l=null!=(l=o.format||(null!=t?t.format:t))?l:d,typeof l===u?l.call(c,{name:"format",hash:{},data:n}):l))+"</td>\n                <td>"+h((l=null!=(l=o.count||(null!=t?t.count:t))?l:d,typeof l===u?l.call(c,{name:"count",hash:{},data:n}):l))+"</td>\n            </tr>\n"},2:function(e,t,o,a,n,s,i){var r,l=null!=t?t:{},c=o.helperMissing,d="function",u=e.escapeExpression,h=e.lambda;return'                    <td><a class="book-id" data-format="'+u((r=null!=(r=o.format||(null!=t?t.format:t))?r:c,typeof r===d?r.call(l,{name:"format",hash:{},data:n}):r))+'" data-bookid="'+u((r=null!=(r=o.id||(null!=t?t.id:t))?r:c,typeof r===d?r.call(l,{name:"id",hash:{},data:n}):r))+'"  data-event="'+u(h(null!=i[1]?i[1].event:i[1],t))+'" data-storeid='+u(h(null!=i[1]?i[1].storeId:i[1],t))+' href="#" >'+u((r=null!=(r=o.id||(null!=t?t.id:t))?r:c,typeof r===d?r.call(l,{name:"id",hash:{},data:n}):r))+"</a></td>\n"},4:function(e,t,o,a,n){var s;return"                    <td>"+e.escapeExpression((s=null!=(s=o.id||(null!=t?t.id:t))?s:o.helperMissing,"function"==typeof s?s.call(null!=t?t:{},{name:"id",hash:{},data:n}):s))+"</td>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,o,a,n,s,i){var r,l,c=null!=t?t:{};return'<table class="table table-bordered table-striped report-list">\n    <thead>\n        <th>Id</th>\n        <th>Name</th>\n        <th>Code</th>\n        <th>Format</th>\n        <th>'+e.escapeExpression((l=null!=(l=o.tableHeader||(null!=t?t.tableHeader:t))?l:o.helperMissing,"function"==typeof l?l.call(c,{name:"tableHeader",hash:{},data:n}):l))+"</th>\n    </thead>\n    <tbody>\n"+(null!=(r=o.each.call(c,null!=t?t.rows:t,{name:"each",hash:{},fn:e.program(1,n,0,s,i),inverse:e.noop,data:n}))?r:"")+"    </tbody>\n</table>\n"},useData:!0,useDepths:!0})}},["./web/static/js/bookActivity.js"]);