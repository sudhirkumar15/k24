webpackJsonp([12],{"./web/static/js/dashboard.js":function(e,t,n){"use strict";(function(e){function s(){var t=y.default.getDateRanges(),n=t.startDate,s=t.endDate,c=e(".store-select-box").chosen().val(),d=e(".select-box-large.institution").chosen().val();r(n,s,c,d),o(n,s,c,d),i(n,s,c,d),a(n,s,c,d),u(n,s,c,d)}function o(t,s,o,a){e.post("/sessions",{storeId:[o],startDate:t,endDate:s,dimension:"day",institutionIds:a,_csrf:A},function(e){if(e.success)return c("daily-app-usage","line",f(e.data),!0);n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)})}function a(t,s,o,a){e.post("/sessions/segments",{storeId:[o],startDate:t,endDate:s,segment:"device_platform",institutionIds:a,_csrf:A},function(e){if(e.success)return c("device_platform","pie",l(e.data),!0);n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)})}function i(t,s,o,a){e.post("/sessions/summary",{storeId:[o],startDate:t,endDate:s,institutionIds:a,_csrf:A},function(t){if(t.success){var s=O()(t.data);return e(".info-box-number.sessions").html(s.sessions),e(".info-box-number.newusers").html(s.newusers),e(".info-box-number.uniqueusers").html(s.users),e(".info-box-number.eventcount").html(s.events)}n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:t})}.bind(null,n)).catch(n.oe)})}function r(t,s,o,a){e.post("/events",{storeId:[o],startDate:t,endDate:s,dimension:"day",eventTypes:["bookOpen"],institutionIds:a,_csrf:A},function(e){if(e.success)return c("book-open","column",d(e.data));n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)})}function u(t,s,o,a){e.post("/events",{storeId:[o],startDate:t,endDate:s,dimension:"day",segment:"app_version",institutionIds:a,_csrf:A},function(e){if(e.success)return c("app_version","area",d(e.data),!0);n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)})}function c(e,t,n,s){b.a.chart(document.getElementsByClassName(e)[0],{chart:{type:t,backgroundColor:"transparent",zoomType:"xy"},credits:{enabled:!1},title:{text:n.length?null:"No data"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %"},showInLegend:!0}},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b '%y"},labels:{style:{fontSize:"13px"}}},yAxis:{title:{text:"Count"}},legend:{enabled:s},tooltip:{shared:!1,formatter:function(){return"pie"!==t?b.a.dateFormat("%e %b %Y",this.x)+"<br />"+this.series.name+": <b>"+this.y+"</b>":this.point.name+"<b> : "+Math.round(this.point.percentage).toFixed(1)+" %</b>"}},series:n})}function d(e){var t={},n=I()(x()(e,"timestamp")),s=I()(x()(e,"segment")),o=x()(s,function(e){return{name:e?e:"Count",data:[]}});return w()(e,function(e){w()(n,function(n){e.timestamp===n&&(t[n]||(t[n]=[]),t[n].push({count:e.count,segment:e.segment?e.segment:"Count"}))})}),w()(t,function(e,t){w()(e,function(e){w()(o,function(n){n.name===e.segment&&n.data.push([j()(1e3*t).utc().valueOf(),+e.count])})})}),o}function l(e){return e.length?[{name:"Platform",colorByPoint:!0,data:x()(e,function(e){return{name:e.segment,y:e.sessions}})}]:[]}function f(e){if(!e.length)return[];var t=[{name:"Sessions",data:[]},{name:"Active Users",data:[]},{name:"New Users",data:[]}];return w()(e,function(e){var n=j()(1e3*e.timestamp).utc().valueOf();t[0].data.push([n,e.sessions]),t[1].data.push([n,e.users]),t[2].data.push([n,e.newusers])}),t}function m(t){var s="institutions:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[s]){var o=JSON.parse(sessionStorage[s]);if(o.length)return h(o)}e.post("/institutions",{storeId:t,_csrf:A},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[s]=JSON.stringify(e.data)),h(e.data);n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)})}function h(t){var n="";e(".select-box-large.institution option").remove(),n=P()(t,function(e,n){return e+"<option "+(C()(t,n.id)!=-1?'selected="selected"':"")+' value="'+n.id+'">'+n.name+"</option>"},""),e(".select-box-large.institution").append(n),e(".select-box-large.institution").chosen().trigger("chosen:updated")}Object.defineProperty(t,"__esModule",{value:!0});var p=n("./node_modules/highcharts/highcharts.js"),b=n.n(p),g=n("./node_modules/moment/moment.js"),j=n.n(g),y=n("./web/static/js/datePicker.js"),v=n("./node_modules/lodash/map.js"),x=n.n(v),_=n("./node_modules/lodash/forEach.js"),w=n.n(_),D=n("./node_modules/lodash/uniq.js"),I=n.n(D),S=n("./node_modules/lodash/head.js"),O=n.n(S),k=n("./node_modules/lodash/reduce.js"),P=n.n(k),q=n("./node_modules/lodash/indexOf.js"),C=n.n(q),N=(n("./web/static/js/common.js"),n("./node_modules/chosen-npm/public/chosen.jquery.js")),A=(n.n(N),e("input[name=_csrf]").val());w()([".store-select-box",".select-box-large.institution"],function(t){e(t).chosen({disable_search:!0})}),e(".store-select-box").children().first().attr("selected","selected"),e(".store-select-box").chosen().change(function(){s(),m(e(".store-select-box").chosen().val())}),e(".select-box-large.institution").chosen().change(function(){s()}),y.default.setDatePicker('.dashboard-date-range input[name="daterange"]',s),s(),m(e(".store-select-box").chosen().val())}).call(t,n("./node_modules/jquery/dist/jquery.js"))}},["./web/static/js/dashboard.js"]);