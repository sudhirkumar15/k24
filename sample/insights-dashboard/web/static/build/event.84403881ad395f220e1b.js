webpackJsonp([6],{"./web/static/js/event.js":function(e,t,n){"use strict";(function(e){function s(t,s){var o=[],l="filters:"+s+":"+t;return t?"undefined"!=typeof Storage&&void 0!==sessionStorage[l]&&(o=JSON.parse(sessionStorage[l]),o.length)?a(o):void e.post("/events/filters",{storeId:[s],type:t,_csrf:N},function(e){if(e.success)return o=e.data.filters,"undefined"!=typeof Storage&&(sessionStorage[l]=JSON.stringify(o)),a(o);n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)}):(e(".select-box-large.filters option").remove(),e(".row.filter-val-row").hide())}function a(t){e(".select-box-large.filters option").remove();var n=w()(t,function(e,t){return e+'<option value="'+t+'">'+t+"</option>"},"");return e(".select-box-large.filters").append(n),e(".select-box-large.filters").chosen().trigger("chosen:updated"),e(".row.filter-val-row").show()}function o(){var t=e(".select-box-large.filter-by").chosen().val(),s=e(".select-box-large.filters").chosen().val(),a=e(".select-box-large.institution").chosen().val(),o=void 0,c=void 0,u=void 0,d=void 0,h=void 0;e(".flash-msgs").remove();var p=m.default.getDateRanges(),f=p.startDate,b=p.endDate;if(!e(".store-select-box").chosen().val())return e(".content-header").append(flash({errors:["Please select a site"]}));switch(t){case"device_platform":o=s;break;case"device_make":c=s;break;case"device_model":u=s;break;case"app_version":d=s;break;case"event_type":h=s}e.post("/events",{storeId:[e(".store-select-box").chosen().val()],startDate:f,endDate:b,dimension:e(".dimension-control button.active").val(),segment:e(".segment-select-box").chosen().val(),source:"app",eventTypes:h,platforms:o,deviceMakes:c,deviceModels:u,appVersions:d,institutionIds:a,_csrf:N},function(t){if(t.success){E=r(t.data),i(E.tabular);var s={headings:[],report:E.tabular};return e(".report-list thead tr").children().each(function(){s.headings.push(e(this).text())}),e('form[name="export"] input[name="export"]').val(JSON.stringify(s)),l(E.chart,e(".chart-type > .active").attr("name"))}n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:t})}.bind(null,n)).catch(n.oe)})}function l(t,n){var s="Select Segment"!==e(".segment-select-box option:selected").text();h.a.chart(document.getElementsByClassName("book-usage")[0],{chart:{type:n,backgroundColor:"transparent",zoomType:"xy"},credits:{enabled:!1},title:{text:t.length?null:"No data"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b '%y"},labels:{style:{fontSize:"13px"}}},plotOptions:{series:{stacking:"normal"}},yAxis:{title:{text:"Count"}},legend:{enabled:s},tooltip:{formatter:function(){return h.a.dateFormat("%e %b %Y",this.x)+"<br />"+this.series.name+": <b>"+this.y+"</b>"}},series:t,exporting:{chartOptions:{plotOptions:{series:{dataLabels:{enabled:!1}}}},scale:3}})}function i(t){var n=e(".segment-select-box option:selected").text();"Select Segment"===n&&(n=""),e(".bookdata").html(O()({rows:t,segment:n})),e(".report-list").DataTable({responsive:!0,lengthChange:!0})}function r(e){var t={},n=j()(g()(e,"timestamp")),s=j()(g()(e,"segment")),a=g()(s,function(e){return{name:e?e:"Count",data:[]}});return x()(e,function(e){x()(n,function(n){e.timestamp===n&&(t[n]||(t[n]=[]),t[n].push({count:e.count,segment:e.segment?e.segment:"Count"}))})}),x()(t,function(e,t){x()(e,function(e){x()(a,function(n){n.name===e.segment&&n.data.push([f()(1e3*t).utc().valueOf(),+e.count])})})}),{tabular:g()(e,function(e){return{timestamp:f()(1e3*e.timestamp).format("DD MMM YYYY"),count:+e.count,segment:e.segment?e.segment:""}}),chart:a}}function c(t){var s="institutions:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[s]){var a=JSON.parse(sessionStorage[s]);if(a.length)return u(a)}e.post("/institutions",{storeId:t,_csrf:N},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[s]=JSON.stringify(e.data)),u(e.data);n.e(0).then(function(){n("./web/static/js/flash.js").default.render({payload:e})}.bind(null,n)).catch(n.oe)})}function u(t){var n="";e(".select-box-large.institution option").remove(),n=w()(t,function(e,n){return e+"<option "+(k()(t,n.id)!=-1?'selected="selected"':"")+' value="'+n.id+'">'+n.name+"</option>"},""),e(".select-box-large.institution").append(n),e(".select-box-large.institution").chosen().trigger("chosen:updated")}Object.defineProperty(t,"__esModule",{value:!0});var d=n("./node_modules/highcharts/highcharts.js"),h=n.n(d),p=n("./node_modules/moment/moment.js"),f=n.n(p),m=n("./web/static/js/datePicker.js"),b=n("./node_modules/lodash/map.js"),g=n.n(b),v=n("./node_modules/lodash/forEach.js"),x=n.n(v),y=n("./node_modules/lodash/uniq.js"),j=n.n(y),_=n("./node_modules/lodash/reduce.js"),w=n.n(_),S=n("./node_modules/lodash/indexOf.js"),k=n.n(S),D=(n("./web/static/js/common.js"),n("./node_modules/chosen-npm/public/chosen.jquery.js")),C=(n.n(D),n("./web/static/views/partials/default/table.hbs")),O=n.n(C),M=n("./node_modules/datatables.net-responsive-bs/js/responsive.bootstrap.js");n.n(M),n("./node_modules/highcharts/modules/exporting.js")(h.a),e('.chart-type > [data-toggle="tooltip"]').tooltip(),e(".store-select-box").children().first().attr("selected","selected");var N=e("input[name=_csrf]").val(),E={chart:[],tabular:[]};x()([".store-select-box",".segment-select-box",".event-select-box",".select-box-large.institution",".select-box-large.filters"],function(t){e(t).chosen({disable_search:!0})}),m.default.setDatePicker('input[name="daterange"]'),e(".dimension-control button").on("click",function(t){t.preventDefault(),e(".dimension-control button").removeClass("active"),e(this).addClass("active")}),e(".btnApply").on("click",function(){o()}),e(".chart-type button").on("click",function(){e(this).siblings().removeClass("active"),e(this).addClass("active"),l(E.chart,e(this).attr("name"))}),e(".select-box-large.filter-by").chosen().change(function(){s(e(this).val(),e(".store-select-box").chosen().val())}),e(".store-select-box").chosen().change(function(){s(e(".select-box-large.filter-by").chosen().val(),e(this).val()),c(e(".store-select-box").chosen().val())}),s(e(".select-box-large.filter-by").chosen().val(),e(".store-select-box").chosen().val()),o(),c(e(".store-select-box").chosen().val())}).call(t,n("./node_modules/jquery/dist/jquery.js"))},"./web/static/views/partials/default/table.hbs":function(e,t,n){var s=n("./node_modules/handlebars/runtime.js");e.exports=(s.default||s).template({1:function(e,t,n,s,a){var o;return"            <th>"+e.escapeExpression((o=null!=(o=n.segment||(null!=t?t.segment:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:{},{name:"segment",hash:{},data:a}):o))+"</th>\n"},3:function(e,t,n,s,a){var o,l,i=null!=t?t:{},r=n.helperMissing,c="function",u=e.escapeExpression;return"            <tr>\n                <td>"+u((l=null!=(l=n.timestamp||(null!=t?t.timestamp:t))?l:r,typeof l===c?l.call(i,{name:"timestamp",hash:{},data:a}):l))+"</td>\n                <td>"+u((l=null!=(l=n.count||(null!=t?t.count:t))?l:r,typeof l===c?l.call(i,{name:"count",hash:{},data:a}):l))+"</td>\n"+(null!=(o=n.if.call(i,null!=t?t.segment:t,{name:"if",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a}))?o:"")+"            </tr>\n"},4:function(e,t,n,s,a){var o;return"                    <td>"+e.escapeExpression((o=null!=(o=n.segment||(null!=t?t.segment:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:{},{name:"segment",hash:{},data:a}):o))+"</td>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,s,a){var o,l=null!=t?t:{};return'<table class="table table-bordered table-striped report-list">\n    <thead>\n        <th>Date</th>\n        <th>Event Count</th>\n'+(null!=(o=n.if.call(l,null!=t?t.segment:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"    </thead>\n    <tbody>\n"+(null!=(o=n.each.call(l,null!=t?t.rows:t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"    </tbody>\n</table>\n"},useData:!0})}},["./web/static/js/event.js"]);