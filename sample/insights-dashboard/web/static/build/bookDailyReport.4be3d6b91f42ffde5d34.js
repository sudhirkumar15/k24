webpackJsonp([8],{"./web/static/js/bookDailyReport.js":function(e,t,o){"use strict";(function(e){function a(t,a){var s=[],i="filters:"+a+":"+t;return t?"undefined"!=typeof Storage&&void 0!==sessionStorage[i]&&(s=JSON.parse(sessionStorage[i]),s.length)?n(s):void e.post("/events/filters",{storeId:[a],type:t,_csrf:H},function(e){if(e.success)return s=e.data.filters,"undefined"!=typeof Storage&&(sessionStorage[i]=JSON.stringify(s)),n(s);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:e})}.bind(null,o)).catch(o.oe)}):(e(".select-box-large.filters option").remove(),e(".row.filter-val-row").hide())}function n(t){e(".select-box-large.filters option").remove();var o=O()(t,function(e,t){return e+'<option value="'+t+'">'+t+"</option>"},"");return e(".select-box-large.filters").append(o),e(".select-box-large.filters").chosen().trigger("chosen:updated"),e(".row.filter-val-row").show()}function s(t){t||(t=e(".store-select-box").chosen().val());var a="institutions:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[a]){var n=JSON.parse(sessionStorage[a]);if(n.length)return i(n)}e.post("/institutions",{storeId:t,_csrf:H},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[a]=JSON.stringify(e.data)),i(e.data);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:e})}.bind(null,o)).catch(o.oe)})}function i(t){var o=J.institutionIds,a="";e(".select-box-large.institution option").remove(),a=O()(t,function(e,t){return e+"<option "+(N()(o,t.id)!=-1?'selected="selected"':"")+' value="'+t.id+'">'+t.name+"</option>"},""),e(".select-box-large.institution").append(a),e(".select-box-large.institution").chosen().trigger("chosen:updated")}function r(t){t||(t=e(".store-select-box").chosen().val());var a="books:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[a]){var n=JSON.parse(sessionStorage[a]);if(n.length)return l(n)}e.post("/books",{storeId:t,_csrf:H},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[a]=JSON.stringify(e.data)),l(e.data);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:e})}.bind(null,o)).catch(o.oe)})}function l(t){var o=J.productIds,a="";e(".select-box-large.book option").remove(),a=O()(t,function(e,t){return e+"<option "+(N()(o,t.id)!=-1?'selected="selected"':"")+' value="'+t.id+'">'+t.name+"</option>"},""),e(".select-box-large.book").append(a),e(".select-box-large.book").chosen().trigger("chosen:updated")}function c(t,o,a,n){e(".flash-msgs").remove(),o||(o=e(".event-type").chosen().val());var s=S.default.getDateRanges(),i=s.startDate,r=s.endDate,l=e(".select-box-large.filter-by").chosen().val(),c=e(".select-box-large.filters").chosen().val(),p=void 0,h=void 0,b=void 0,f=void 0;switch(l){case"device_platform":p=c;break;case"device_make":h=c;break;case"device_model":b=c;break;case"app_version":f=c}switch(o){case"timespent":u(t,i,r,a,n,p,h,b,f);break;default:d(t,i,r,o,a,n,p,h,b,f)}e(".book-daily-report .box-title").html(V[o].heading),e(".book-daily-report .box-title-help").attr("data-original-title",V[o].tooltip),e("ul.sidebar-menu ."+E[0]+"-"+E[1]+" li").removeClass("active"),e("ul.sidebar-menu ."+E[0]+"-"+E[1]+"-"+o).addClass("active")}function d(t,a,n,s,i,r,l,c,d,u){t||(t=e(".store-select-box").chosen().val()),s||(s=e(".event-type").chosen().val()),e.post("/events",{storeId:[t],startDate:a,endDate:n,dimension:"day",eventTypes:[s],institutionIds:i,productIds:r,platforms:l,deviceMakes:c,deviceModels:d,appVersions:u,_csrf:H},function(a){if(a.success){var n=!0;switch(F=b(a.data,s),s){case"bookDownloadComplete":case"bookOpen":case"searchResult":n=!1}return m(F.tabular,t,s,"Activity Count",n),v("/books/activity/export"),p(F.chart,e(".chart-type > .active").attr("name"))}o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:a})}.bind(null,o)).catch(o.oe)})}function u(t,a,n,s,i,r,l,c,d){t||(t=e(".store-select-box").chosen().val()),e.post("/books/timespent/summary",{storeId:t,startDate:a,endDate:n,institutionIds:s,productIds:i,platforms:r,deviceMakes:l,deviceModels:c,appVersions:d,_csrf:H},function(a){if(a.success)return F=f(a.data),m(F.tabular,t,"timespent","Duration in HH:MM:SS"),v("/books/timespent/export"),h(e(".chart-type > .active").attr("name"),F.chart);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:a})}.bind(null,o)).catch(o.oe)})}function p(e,t){y.a.chart(document.getElementsByClassName("top-books")[0],{chart:{type:t,backgroundColor:"transparent",zoomType:"xy"},credits:{enabled:!1},title:{text:e.length?null:"No data"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b '%y"},labels:{style:{fontSize:"13px"}}},plotOptions:{series:{stacking:"normal"}},yAxis:{title:{text:"Activity count"}},legend:{enabled:!1},tooltip:{formatter:function(){return"Date : "+y.a.dateFormat("%e %b, %Y",this.x)+"<br />"+this.series.name+"<br /> count : <b>"+this.y+"</b>"}},series:e,exporting:{chartOptions:{plotOptions:{series:{dataLabels:{enabled:!1}}}},scale:3}})}function h(e,t){y.a.chart(document.getElementsByClassName("top-books")[0],{chart:{type:e,backgroundColor:"transparent",zoomType:"xy"},credits:{enabled:!1},title:{text:t.length?null:"No data"},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%e %b '%y"},labels:{style:{fontSize:"13px"}}},yAxis:{title:{text:"Hours"},labels:{formatter:function(){var e=this.value,t=void 0,o=void 0;return this.value=1e3*e,t=e/60|0,e-=60*t,o=t/60|0,t-=60*o,o}},startOnTick:!1,showFirstLabel:!1},legend:{enabled:!1},tooltip:{shared:!1,formatter:function(){var e=parseInt(this.y/3600)%24,t=parseInt(this.y/60)%60,o=this.y%60;return e=e<10?"0"+e:e,t=t<10?"0"+t:t,o=o<10?"0"+o:o,y.a.dateFormat("%e %b, %Y",this.x)+"<br />"+this.series.name+": <b>"+e+":"+t+":"+o+"</b>"}},series:t})}function b(e,t){var o={tabular:[],chart:[]};return e.length?(o.tabular=T()(e,function(e){return{date:j()(1e3*e.timestamp).format("DD MMM YYYY"),count:e.count}}),o.chart=[{name:"Activity : "+t,data:T()(e,function(e){return[j()(1e3*e.timestamp).utc().valueOf(),e.count]})}],o):o}function f(e){var t={tabular:[],chart:[]};return e.length?(t.tabular=T()(e,function(e){var t=parseInt(e.duration/3600)%24,o=parseInt(e.duration/60)%60,a=e.duration%60;return t=t<10?"0"+t:t,o=o<10?"0"+o:o,a=a<10?"0"+a:a,{date:j()(1e3*e.timestamp).format("DD MMM YYYY"),count:t+":"+o+":"+a}}),t.chart=[{name:"Time spent",data:T()(e,function(e){return[j()(1e3*e.timestamp).utc().valueOf(),e.duration]})}],t):t}function m(t,o,a,n){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];e(".bookdata").html(B()({rows:t,storeId:o,event:a,tableHeader:n,showLink:s})),e(".report-list").DataTable({responsive:!0,lengthChange:!0})}function v(t){var o={report:F.tabular};e('form[name="export"]').attr("action",t),e('form[name="export"] input[name="export"]').val(JSON.stringify(o))}Object.defineProperty(t,"__esModule",{value:!0});var g=o("./node_modules/highcharts/highcharts.js"),y=o.n(g),x=o("./node_modules/qs/lib/index.js"),k=o.n(x),w=o("./node_modules/moment/moment.js"),j=o.n(w),S=o("./web/static/js/datePicker.js"),D=o("./node_modules/lodash/forEach.js"),_=o.n(D),I=o("./node_modules/lodash/reduce.js"),O=o.n(I),C=o("./node_modules/lodash/map.js"),T=o.n(C),M=o("./node_modules/lodash/indexOf.js"),N=o.n(M),A=(o("./web/static/js/common.js"),o("./node_modules/chosen-npm/public/chosen.jquery.js")),Y=(o.n(A),o("./web/static/views/partials/default/tableBookDaily.hbs")),B=o.n(Y),P=o("./node_modules/datatables.net-responsive-bs/js/responsive.bootstrap.js");o.n(P),o("./node_modules/highcharts/modules/exporting.js")(y.a),e('.chart-type > [data-toggle="tooltip"]').tooltip();var H=e("input[name=_csrf]").val(),J=k.a.parse(window.location.search.substring(1)),E=window.location.pathname.substring(1).split("/"),F={chart:[],tabular:[],caption:"Count"},V={bookDownloadComplete:{heading:"Book Download",tooltip:"Total number of books downloaded within the specified duration"},bookOpen:{heading:"Book Open",tooltip:"Total number of books opened within the specified duration"},noteAdd:{heading:"Notes",tooltip:"Total number of notes created within the specified duration"},bookmarkAdd:{heading:"Bookmarks",tooltip:"Total number of bookmarks created within the specified duration"},highlightAdd:{heading:"Highlights",tooltip:"Total number of highlights created within the specified duration"},searchResult:{heading:"Searches",tooltip:"Total number of searches performed within the specified duration"},pageView:{heading:"Page Views (PDF)",tooltip:"Count of the total number of page views, for a specified duration. Page views are for PDF books"},contentView:{heading:"Content Views (EPUB)",tooltip:"Count of the total number of content views, for a specified duration. Content views are for EPUB books"},timespent:{heading:"Time Spent",tooltip:"The time spent on books, in hours, for the specified duration"}};_()([".store-select-box",".select-box-large.institution",".select-box-large.event-type"],function(t){e(t).chosen({disable_search:!0})}),e(".store-select-box").chosen().change(function(){s(),r(),a(e(".select-box-large.filter-by").chosen().val(),e(this).val())}),S.default.setDatePicker('input[name="daterange"]'),e(".book-daily-report .box-title").html(V[e(".select-box-large.event-type").chosen().val()].heading),e(".book-daily-report .box-title-help").attr("data-original-title",V[e(".select-box-large.event-type").chosen().val()].tooltip),a(e(".select-box-large.filter-by").chosen().val(),e(".store-select-box").chosen().val()),e(".btnApply").on("click",function(){c(e(".store-select-box").chosen().val(),e(".select-box-large.event-type").chosen().val(),e(".select-box-large.institution").chosen().val(),e(".select-box-large.book").chosen().val())}),e(".chart-type button").on("click",function(){e(this).siblings().removeClass("active"),e(this).addClass("active"),p(F.chart,e(this).attr("name"))}),e(".select-box-large.filter-by").chosen().change(function(){a(e(this).val(),e(".store-select-box").chosen().val())}),s(J.storeId),r(J.storeId),c(J.storeId,J.event,J.institutionIds,J.productIds)}).call(t,o("./node_modules/jquery/dist/jquery.js"))},"./web/static/views/partials/default/tableBookDaily.hbs":function(e,t,o){var a=o("./node_modules/handlebars/runtime.js");e.exports=(a.default||a).template({1:function(e,t,o,a,n){var s,i=null!=t?t:{},r=o.helperMissing,l="function",c=e.escapeExpression;return"            <tr>\n                <td>"+c((s=null!=(s=o.date||(null!=t?t.date:t))?s:r,typeof s===l?s.call(i,{name:"date",hash:{},data:n}):s))+"</td>\n                <td>"+c((s=null!=(s=o.count||(null!=t?t.count:t))?s:r,typeof s===l?s.call(i,{name:"count",hash:{},data:n}):s))+"</td>\n            </tr>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,o,a,n){var s,i,r=null!=t?t:{};return'<table class="table table-bordered table-striped report-list">\n    <thead>\n        <th>Date</th>\n        <th>'+e.escapeExpression((i=null!=(i=o.tableHeader||(null!=t?t.tableHeader:t))?i:o.helperMissing,"function"==typeof i?i.call(r,{name:"tableHeader",hash:{},data:n}):i))+"</th>\n    </thead>\n    <tbody>\n"+(null!=(s=o.each.call(r,null!=t?t.rows:t,{name:"each",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?s:"")+"    </tbody>\n</table>\n"},useData:!0})}},["./web/static/js/bookDailyReport.js"]);