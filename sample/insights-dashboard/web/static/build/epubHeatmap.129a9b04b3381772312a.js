webpackJsonp([7],{"./node_modules/highcharts/modules/heatmap.js":function(t,e){!function(e){"object"==typeof t&&t.exports?t.exports=e:e(Highcharts)}(function(t){!function(t){var e,o=t.Axis,s=t.Chart,i=t.color,n=t.each,a=t.extend,r=t.isNumber,l=t.Legend,h=t.LegendSymbolMixin,c=t.noop,d=t.merge,p=t.pick,u=t.wrap;e=t.ColorAxis=function(){this.init.apply(this,arguments)},a(e.prototype,o.prototype),a(e.prototype,{defaultColorAxisOptions:{lineWidth:0,minPadding:0,maxPadding:0,gridLineWidth:1,tickPixelInterval:72,startOnTick:!0,endOnTick:!0,offset:0,marker:{animation:{duration:50},width:.01,color:"#999999"},labels:{overflow:"justify",rotation:0},minColor:"#e6ebf5",maxColor:"#003399",tickLength:5,showInLegend:!0},keepProps:["legendGroup","legendItemHeight","legendItemWidth","legendItem","legendSymbol"].concat(o.prototype.keepProps),init:function(t,e){var s,i="vertical"!==t.options.legend.layout;this.coll="colorAxis",s=d(this.defaultColorAxisOptions,{side:i?2:1,reversed:!i},e,{opposite:!i,showEmpty:!1,title:null}),o.prototype.init.call(this,t,s),e.dataClasses&&this.initDataClasses(e),this.initStops(e),this.horiz=i,this.zoomEnabled=!1,this.defaultLegendLength=200},tweenColors:function(t,e,o){var s;return e.rgba.length&&t.rgba.length?(t=t.rgba,e=e.rgba,s=1!==e[3]||1!==t[3],t=(s?"rgba(":"rgb(")+Math.round(e[0]+(t[0]-e[0])*(1-o))+","+Math.round(e[1]+(t[1]-e[1])*(1-o))+","+Math.round(e[2]+(t[2]-e[2])*(1-o))+(s?","+(e[3]+(t[3]-e[3])*(1-o)):"")+")"):t=e.input||"none",t},initDataClasses:function(t){var e,o=this,s=this.chart,a=0,r=s.options.chart.colorCount,l=this.options,h=t.dataClasses.length;this.dataClasses=e=[],this.legendItems=[],n(t.dataClasses,function(t,n){t=d(t),e.push(t),t.color||("category"===l.dataClassColor?(n=s.options.colors,r=n.length,t.color=n[a],t.colorIndex=a,++a===r&&(a=0)):t.color=o.tweenColors(i(l.minColor),i(l.maxColor),2>h?.5:n/(h-1)))})},initStops:function(t){this.stops=t.stops||[[0,this.options.minColor],[1,this.options.maxColor]],n(this.stops,function(t){t.color=i(t[1])})},setOptions:function(t){o.prototype.setOptions.call(this,t),this.options.crosshair=this.options.marker},setAxisSize:function(){var t,e,o=this.legendSymbol,s=this.chart,i=s.options.legend||{};o?(this.left=i=o.attr("x"),this.top=t=o.attr("y"),this.width=e=o.attr("width"),this.height=o=o.attr("height"),this.right=s.chartWidth-i-e,this.bottom=s.chartHeight-t-o,this.len=this.horiz?e:o,this.pos=this.horiz?i:t):this.len=(this.horiz?i.symbolWidth:i.symbolHeight)||this.defaultLegendLength},toColor:function(t,e){var o,s,i,n,a=this.stops,r=this.dataClasses;if(r){for(n=r.length;n--;)if(i=r[n],o=i.from,a=i.to,(void 0===o||t>=o)&&(void 0===a||t<=a)){s=i.color,e&&(e.dataClass=n,e.colorIndex=i.colorIndex);break}}else{for(this.isLog&&(t=this.val2lin(t)),t=1-(this.max-t)/(this.max-this.min||1),n=a.length;n--&&!(t>a[n][0]););o=a[n]||a[n+1],a=a[n+1]||o,t=1-(a[0]-t)/(a[0]-o[0]||1),s=this.tweenColors(o.color,a.color,t)}return s},getOffset:function(){var t=this.legendGroup,e=this.chart.axisOffset[this.side];t&&(this.axisParent=t,o.prototype.getOffset.call(this),this.added||(this.added=!0,this.labelLeft=0,this.labelRight=this.width),this.chart.axisOffset[this.side]=e)},setLegendColor:function(){var t,e=this.options,o=this.reversed;t=o?1:0,o=o?0:1,t=this.horiz?[t,0,o,0]:[0,o,0,t],this.legendColor={linearGradient:{x1:t[0],y1:t[1],x2:t[2],y2:t[3]},stops:e.stops||[[0,e.minColor],[1,e.maxColor]]}},drawLegendSymbol:function(t,e){var o=t.padding,s=t.options,i=this.horiz,n=p(s.symbolWidth,i?this.defaultLegendLength:12),a=p(s.symbolHeight,i?12:this.defaultLegendLength),r=p(s.labelPadding,i?16:30),s=p(s.itemDistance,10);this.setLegendColor(),e.legendSymbol=this.chart.renderer.rect(0,t.baseline-11,n,a).attr({zIndex:1}).add(e.legendGroup),this.legendItemWidth=n+o+(i?s:r),this.legendItemHeight=a+o+(i?r:0)},setState:c,visible:!0,setVisible:c,getSeriesExtremes:function(){var t=this.series,e=t.length;for(this.dataMin=1/0,this.dataMax=-(1/0);e--;)void 0!==t[e].valueMin&&(this.dataMin=Math.min(this.dataMin,t[e].valueMin),this.dataMax=Math.max(this.dataMax,t[e].valueMax))},drawCrosshair:function(t,e){var s,i=e&&e.plotX,n=e&&e.plotY,a=this.pos,r=this.len;e&&(s=this.toPixels(e[e.series.colorKey]),s<a?s=a-2:s>a+r&&(s=a+r+2),e.plotX=s,e.plotY=this.len-s,o.prototype.drawCrosshair.call(this,t,e),e.plotX=i,e.plotY=n,this.cross&&(this.cross.addClass("highcharts-coloraxis-marker").add(this.legendGroup),this.cross.attr({fill:this.crosshair.color})))},getPlotLinePath:function(t,e,s,i,n){return r(n)?this.horiz?["M",n-4,this.top-6,"L",n+4,this.top-6,n,this.top,"Z"]:["M",this.left,n,"L",this.left-6,n+6,this.left-6,n-6,"Z"]:o.prototype.getPlotLinePath.call(this,t,e,s,i)},update:function(t,e){var s=this.chart,i=s.legend;n(this.series,function(t){t.isDirtyData=!0}),t.dataClasses&&i.allItems&&(n(i.allItems,function(t){t.isDataClass&&t.legendGroup.destroy()}),s.isDirtyLegend=!0),s.options[this.coll]=d(this.userOptions,t),o.prototype.update.call(this,t,e),this.legendItem&&(this.setLegendColor(),i.colorizeItem(this,!0))},getDataClassLegendSymbols:function(){var e,o=this,s=this.chart,i=this.legendItems,r=s.options.legend,l=r.valueDecimals,d=r.valueSuffix||"";return i.length||n(this.dataClasses,function(r,p){var u=!0,g=r.from,f=r.to;e="",void 0===g?e="< ":void 0===f&&(e="> "),void 0!==g&&(e+=t.numberFormat(g,l)+d),void 0!==g&&void 0!==f&&(e+=" - "),void 0!==f&&(e+=t.numberFormat(f,l)+d),i.push(a({chart:s,name:e,options:{},drawLegendSymbol:h.drawRectangle,visible:!0,setState:c,isDataClass:!0,setVisible:function(){u=this.visible=!u,n(o.series,function(t){n(t.points,function(t){t.dataClass===p&&t.setVisible(u)})}),s.legend.colorizeItem(this,u)}},r))}),i},name:""}),n(["fill","stroke"],function(o){t.Fx.prototype[o+"Setter"]=function(){this.elem.attr(o,e.prototype.tweenColors(i(this.start),i(this.end),this.pos),null,!0)}}),u(s.prototype,"getAxes",function(t){var o=this.options.colorAxis;t.call(this),this.colorAxis=[],o&&new e(this,o)}),u(l.prototype,"getAllItems",function(t){var e=[],o=this.chart.colorAxis[0];return o&&o.options&&(o.options.showInLegend&&(o.options.dataClasses?e=e.concat(o.getDataClassLegendSymbols()):e.push(o)),n(o.series,function(t){t.options.showInLegend=!1})),e.concat(t.call(this))}),u(l.prototype,"colorizeItem",function(t,e,o){t.call(this,e,o),o&&e.legendColor&&e.legendSymbol.attr({fill:e.legendColor})})}(t),function(t){var e=t.defined,o=t.each,s=t.noop,i=t.seriesTypes;t.colorPointMixin={isValid:function(){return null!==this.value},setVisible:function(t){var e=this,s=t?"show":"hide";o(["graphic","dataLabel"],function(t){e[t]&&e[t][s]()})},setState:function(e){t.Point.prototype.setState.call(this,e),this.graphic&&this.graphic.attr({zIndex:"hover"===e?1:0})}},t.colorSeriesMixin={pointArrayMap:["value"],axisTypes:["xAxis","yAxis","colorAxis"],optionalAxis:"colorAxis",trackerGroups:["group","markerGroup","dataLabelsGroup"],getSymbol:s,parallelArrays:["x","y","value"],colorKey:"value",pointAttribs:i.column.prototype.pointAttribs,translateColors:function(){var t=this,e=this.options.nullColor,s=this.colorAxis,i=this.colorKey;o(this.data,function(o){var n=o[i];(n=o.options.color||(o.isNull?e:s&&void 0!==n?s.toColor(n,o):o.color||t.color))&&(o.color=n)})},colorAttribs:function(t){var o={};return e(t.color)&&(o[this.colorProp||"fill"]=t.color),o}}}(t),function(t){var e=t.colorPointMixin,o=t.each,s=t.merge,i=t.noop,n=t.pick,a=t.Series,r=t.seriesType,l=t.seriesTypes;r("heatmap","scatter",{animation:!1,borderWidth:0,nullColor:"#f7f7f7",dataLabels:{formatter:function(){return this.point.value},inside:!0,verticalAlign:"middle",crop:!1,overflow:!1,padding:0},marker:null,pointRange:null,tooltip:{pointFormat:"{point.x}, {point.y}: {point.value}<br/>"},states:{normal:{animation:!0},hover:{halo:!1,brightness:.2}}},s(t.colorSeriesMixin,{pointArrayMap:["y","value"],hasPointSpecificOptions:!0,supportsDrilldown:!0,getExtremesFromAll:!0,directTouch:!0,init:function(){var t;l.scatter.prototype.init.apply(this,arguments),t=this.options,t.pointRange=n(t.pointRange,t.colsize||1),this.yAxis.axisPointRange=t.rowsize||1},translate:function(){var t=this.options,e=this.xAxis,s=this.yAxis,i=function(t,e,o){return Math.min(Math.max(e,t),o)};this.generatePoints(),o(this.points,function(o){var n=(t.colsize||1)/2,a=(t.rowsize||1)/2,r=i(Math.round(e.len-e.translate(o.x-n,0,1,0,1)),-e.len,2*e.len),n=i(Math.round(e.len-e.translate(o.x+n,0,1,0,1)),-e.len,2*e.len),l=i(Math.round(s.translate(o.y-a,0,1,0,1)),-s.len,2*s.len),a=i(Math.round(s.translate(o.y+a,0,1,0,1)),-s.len,2*s.len);o.plotX=o.clientX=(r+n)/2,o.plotY=(l+a)/2,o.shapeType="rect",o.shapeArgs={x:Math.min(r,n),y:Math.min(l,a),width:Math.abs(n-r),height:Math.abs(a-l)}}),this.translateColors()},drawPoints:function(){l.column.prototype.drawPoints.call(this),o(this.points,function(t){t.graphic.attr(this.colorAttribs(t))},this)},animate:i,getBox:i,drawLegendSymbol:t.LegendSymbolMixin.drawRectangle,alignDataLabel:l.column.prototype.alignDataLabel,getExtremes:function(){a.prototype.getExtremes.call(this,this.valueData),this.valueMin=this.dataMin,this.valueMax=this.dataMax,a.prototype.getExtremes.call(this)}}),e)}(t)})},"./web/static/js/epubHeatmap.js":function(t,e,o){"use strict";(function(t){function s(e,s,n){var a=[],r="filters:"+s+":"+e;return e?"undefined"!=typeof Storage&&void 0!==sessionStorage[r]&&(a=JSON.parse(sessionStorage[r]),a.length)?i(a,n):void t.post("/events/filters",{storeId:[s],type:e,_csrf:P},function(t){if(t.success)return a=t.data.filters,"undefined"!=typeof Storage&&(sessionStorage[r]=JSON.stringify(a)),i(a,n);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:t})}.bind(null,o)).catch(o.oe)}):(t(".select-box-large.filters option").remove(),t(".row.filter-val-row").hide())}function i(e,o){t(".select-box-large.filters option").remove();var s=S()(e,function(t,e){return t+"<option "+(M()(o,e)!=-1?'selected="selected"':"")+' value="'+e+'">'+e+"</option>"},"");t(".select-box-large.filters").append(s),t(".select-box-large.filters").chosen().trigger("chosen:updated"),t(".row.filter-val-row").show()}function n(e){e||(e=t(".store-select-box").chosen().val());var s="institutions-"+e;if("undefined"!=typeof Storage&&void 0!==sessionStorage[s])return a(JSON.parse(sessionStorage[s]));t.post("/institutions",{storeId:e,_csrf:P},function(t){if(t.success)return"undefined"!=typeof Storage&&(sessionStorage[s]=JSON.stringify(t.data)),a(t.data);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:t})}.bind(null,o)).catch(o.oe)})}function a(e){var o=_.institutionIds,s="";t(".select-box-large.institution option").remove(),s=S()(e,function(t,e){return t+"<option "+(M()(o,e.id)!=-1?'selected="selected"':"")+' value="'+e.id+'">'+e.name+"</option>"},""),t(".select-box-large.institution").append(s),t(".select-box-large.institution").chosen().trigger("chosen:updated")}function r(e){e||(e=t(".store-select-box").chosen().val());var s="books:"+e;if("undefined"!=typeof Storage&&void 0!==sessionStorage[s]){var i=JSON.parse(sessionStorage[s]);if(i.length)return l(i)}t.post("/books",{storeId:e,_csrf:P},function(t){if(t.success)return"undefined"!=typeof Storage&&(sessionStorage[s]=JSON.stringify(t.data)),l(t.data);o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:t})}.bind(null,o)).catch(o.oe)})}function l(e){var o=_.bookId,s="<option>Please select a book </option>",i=!1;t(".select-box-large.book option").remove(),s=S()(e,function(t,e){return e.id===o&&(i=!0),t+"<option "+(e.id===o?'selected="selected"':"")+' value="'+e.id+'">'+e.name+"</option>"},s),o&&!i&&(s='<option selected="selected" value="'+o+'">'+o+"</option>"+s),t(".select-box-large.book").append(s),t(".select-box-large.book").chosen().trigger("chosen:updated")}function h(e,s,i,n){var a=v.default.getDateRanges(),r=a.startDate,l=a.endDate,h=t(".select-box-large.filter-by").chosen().val(),p=t(".select-box-large.filters").chosen().val(),u=void 0,g=void 0,f=void 0,m=void 0;switch(h){case"device_platform":u=p;break;case"device_make":g=p;break;case"device_model":f=p;break;case"app_version":m=p}e||(e=t(".store-select-box").chosen().val()),i||(i=t(".select-box-large.event-type").chosen().val()),s||(s=t(".select-box-large.book").chosen().val()),t.post("/books/epub/contents",{storeId:e,startDate:r,endDate:l,bookId:s,events:[i],institutionIds:n,platforms:u,deviceMakes:g,deviceModels:f,appVersions:m,_csrf:P},function(e){if(e.success)return c("chart-data",d(e.data),t(".select-box-large.event-type option:selected").html());o.e(0).then(function(){o("./web/static/js/flash.js").default.render({payload:e})}.bind(null,o)).catch(o.oe)}),t(".heatmap-report .box-title").html(O[i].heading),t(".heatmap-report .box-title-help").attr("data-original-title",O[i].tooltip),t("ul.sidebar-menu ."+D[0]+"-"+D[1]+"-"+D[2]+" li").removeClass("active"),t("ul.sidebar-menu ."+D[0]+"-"+D[1]+"-"+D[2]+"-"+i).addClass("active")}function c(e,o,s){if(!o.data.length)return t("."+e).html('<div class="no-data"><span>No data</span></div>');var i=u.a.getOptions().colors;u.a.chart(document.getElementsByClassName(e)[0],{chart:{type:"heatmap",backgroundColor:"transparent",zoomType:"xy",inverted:!0},credits:{enabled:!1},title:{text:o.data.length?s:"No data"},xAxis:{title:null,categories:o.catxAxis},yAxis:{title:null,gridLineColor:"transparent",categories:o.displayPages},colorAxis:{min:1,type:"logarithmic",minColor:i[11],maxColor:i[12],stops:[[0,i[11]],[.67,i[13]],[1,i[12]]]},legend:{align:"right",layout:"vertical",margin:0,verticalAlign:"top",y:25,symbolHeight:320},tooltip:{formatter:function(){return"<b> Name :  </b>"+(o.displayPages[this.point.y]?o.displayPages[this.point.y]:o.catyAxis[this.point.y])+"<br><b>"+s+"</b> : "+this.point.value+"<br> <b>"+("Overall"!==o.catxAxis[this.point.x]?"Date : ":"Type : ")+"</b>"+o.catxAxis[this.point.x]}},series:[{name:"Content view by date",borderWidth:0,data:o.data,dataLabels:{enabled:!1,style:{textShadow:!1}}}]})}function d(t){var e=[],o=[],s=[],i=I()(w()(t,"url")),n=I()(w()(t,"timestamp")),a=void 0;return y()(i,function(i,a){y()(n,function(n,r){y()(t,function(t){t.timestamp===n&&t.url===i&&(e.push([r,a,t.count]),s[a]||(s[a]=t.name?t.name:t.url),o[a]?o[a]=o[a]+t.count:o[a]=t.count)})})}),y()(i,function(t,s){o[s]&&e.push([n.length,s,o[s]])}),a=w()(n,function(t){return b()(1e3*t).format("DD MMM YYYY")}),a.push("Overall"),{catxAxis:a,catyAxis:i,displayPages:s,data:e}}Object.defineProperty(e,"__esModule",{value:!0});var p=o("./node_modules/highcharts/highcharts.js"),u=o.n(p),g=o("./node_modules/qs/lib/index.js"),f=o.n(g),m=o("./node_modules/moment/moment.js"),b=o.n(m),v=o("./web/static/js/datePicker.js"),x=o("./node_modules/lodash/forEach.js"),y=o.n(x),C=o("./node_modules/lodash/map.js"),w=o.n(C),k=o("./node_modules/lodash/reduce.js"),S=o.n(k),A=o("./node_modules/lodash/indexOf.js"),M=o.n(A),L=o("./node_modules/lodash/uniq.js"),I=o.n(L),j=(o("./web/static/js/common.js"),o("./node_modules/chosen-npm/public/chosen.jquery.js"));o.n(j),o("./node_modules/highcharts/modules/exporting.js")(u.a),o("./node_modules/highcharts/modules/heatmap.js")(u.a);var P=t("input[name=_csrf]").val(),_=f.a.parse(window.location.search.substring(1)),D=window.location.pathname.substring(1).split("/"),O={noteAdd:{heading:"EPUB Heatmap - Notes",tooltip:"The darker shades represent more users creating notes on those contents of the selected book"},bookmarkAdd:{heading:"EPUB Heatmap - Bookmarks",tooltip:"The darker shades represent more users bookmarking the content of the selected book"},highlightAdd:{heading:"EPUB Heatmap - Highlights",tooltip:"The darker shades represent more users creating highlights on those contents of the selected book"},contentView:{heading:"EPUB Heatmap - Content Views",tooltip:"The darker shades represent more user views for those contents of the selected book"},contentScroll:{heading:"EPUB Heatmap - Content Views",tooltip:"The darker shades represent more user activity in terms of content scrolling within the selected book"}};y()([".store-select-box",".select-box-large.institution",".select-box-large.event-type"],function(e){t(e).chosen({disable_search:!0})}),v.default.setDatePicker('input[name="daterange"]'),t(".btnApply").on("click",function(){h(t(".store-select-box").chosen().val(),t(".select-box-large.book").chosen().val(),t(".select-box-large.event-type").chosen().val(),t(".select-box-large.institution").chosen().val())}),t(".store-select-box").chosen().change(function(){n(t(this).val()),r(t(this).val())}),n(_.storeId),r(_.storeId),_.bookId?h(_.storeId,_.bookId,_.event,_.institutionIds):t(".heatmap-report .loading").hide(),s(t(".select-box-large.filter-by").chosen().val(),t(".store-select-box").chosen().val(),_.filterVals),t(".select-box-large.filter-by").chosen().change(function(){s(t(this).val(),t(".store-select-box").chosen().val())})}).call(e,o("./node_modules/jquery/dist/jquery.js"))}},["./web/static/js/epubHeatmap.js"]);