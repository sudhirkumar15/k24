webpackJsonp([4],{"./web/static/js/userActivity.js":function(e,t,s){"use strict";(function(e){function n(t,n,o){var i=[],r="filters:"+n+":"+t;return t?"undefined"!=typeof Storage&&void 0!==sessionStorage[r]&&(i=JSON.parse(sessionStorage[r]),i.length)?a(i,o):void e.post("/events/filters",{storeId:[n],type:t,_csrf:M},function(e){if(e.success)return i=e.data.filters,"undefined"!=typeof Storage&&(sessionStorage[r]=JSON.stringify(i)),a(i,o);s.e(0).then(function(){s("./web/static/js/flash.js").default.render({payload:e})}.bind(null,s)).catch(s.oe)}):(e(".select-box-large.filters option").remove(),e(".row.filter-val-row").hide())}function a(t,s){e(".select-box-large.filters option").remove();var n=k()(t,function(e,t){return e+"<option "+(D()(s,t)!=-1?'selected="selected"':"")+' value="'+t+'">'+t+"</option>"},"");e(".select-box-large.filters").append(n),e(".select-box-large.filters").chosen().trigger("chosen:updated"),e(".row.filter-val-row").show()}function o(t){t||(t=e(".store-select-box").chosen().val());var n="institutions:"+t;if("undefined"!=typeof Storage&&void 0!==sessionStorage[n]){var a=JSON.parse(sessionStorage[n]);if(a.length)return i(a)}e.post("/institutions",{storeId:t,_csrf:M},function(e){if(e.success)return"undefined"!=typeof Storage&&(sessionStorage[n]=JSON.stringify(e.data)),i(e.data);s.e(0).then(function(){s("./web/static/js/flash.js").default.render({payload:e})}.bind(null,s)).catch(s.oe)})}function i(t){var s=q.institutionIds,n="";e(".select-box-large.institution option").remove(),n=k()(t,function(e,t){return e+"<option "+(D()(s,t.id)!=-1?'selected="selected"':"")+' value="'+t.id+'">'+t.name+"</option>"},""),e(".select-box-large.institution").append(n),e(".select-box-large.institution").chosen().trigger("chosen:updated")}function r(t,s,n,a){e(".flash-msgs").remove();var o=y.default.getDateRanges(),i=o.startDate,r=o.endDate,u=e(".select-box-large.filter-by").chosen().val(),h=e(".select-box-large.filters").chosen().val();t||(t=e(".store-select-box").chosen().val()),s||(s=e(".event-type").chosen().val());var p=void 0,f=void 0,m=void 0,b=void 0;switch(u){case"device_platform":p=h;break;case"device_make":f=h;break;case"device_model":m=h;break;case"app_version":b=h}switch(s){case"activeUsers":l(t,i,r,n,a,p,f,m,b);break;case"newUsers":c(t,i,r,n,a,p,f,m,b);break;default:d(t,i,r,s,n,a,p,f,m,b)}e(".user-activity-report .box-title").html(B[s].heading),e(".user-activity-report .box-title-help").attr("data-original-title",B[s].tooltip),e("ul.sidebar-menu ."+E[0]+"-"+E[1]+" li").removeClass("active"),e("ul.sidebar-menu ."+E[0]+"-"+E[1]+"-"+s).addClass("active")}function l(t,n,a,o,i,r,l,c,d){e.post("/users/active",{storeId:t,startDate:n,endDate:a,institutionIds:o,productIds:i,platforms:r,deviceMakes:l,deviceModels:c,appVersions:d,limit:100,_csrf:M},function(t){if(t.success)return J=h(t.data),J.caption="Session count",p(J),f(),u(J.chart,e(".chart-type > .active").attr("name"));s.e(0).then(function(){s("./web/static/js/flash.js").default.render({payload:t})}.bind(null,s)).catch(s.oe)})}function c(t,n,a,o,i,r,l,c,d){e.post("/users/new",{storeId:t,startDate:n,endDate:a,institutionIds:o,productIds:i,limit:100,platforms:r,deviceMakes:l,deviceModels:c,appVersions:d,_csrf:M},function(t){if(t.success)return J=h(t.data),J.caption="Session count",p(J),f(),u(J.chart,e(".chart-type > .active").attr("name"));s.e(0).then(function(){s("./web/static/js/flash.js").default.render({payload:t})}.bind(null,s)).catch(s.oe)})}function d(t,n,a,o,i,r,l,c,d,m){e.post("/users/events",{storeId:t,startDate:n,endDate:a,events:[o],institutionIds:i,productIds:r,platforms:l,deviceMakes:c,deviceModels:d,appVersions:m,limit:100,_csrf:M},function(t){if(t.success)return J=h(t.data),p(J),f(),u(J.chart,e(".chart-type > .active").attr("name"));s.e(0).then(function(){s("./web/static/js/flash.js").default.render({payload:t})}.bind(null,s)).catch(s.oe)})}function u(e,t){b.a.chart(document.getElementsByClassName("top-users")[0],{chart:{type:t,backgroundColor:"transparent",zoomType:"xy"},credits:{enabled:!1},title:{text:e.length?null:"No data"},xAxis:{type:"category",labels:{style:{fontSize:"13px"}}},plotOptions:{series:{stacking:"normal"}},yAxis:{title:{text:J.caption}},legend:{enabled:!1},tooltip:{formatter:function(){return"Name : "+this.point.name+" <br/> Count :  "+this.y}},series:e,exporting:{chartOptions:{plotOptions:{series:{dataLabels:{enabled:!1}}}},scale:3}})}function h(e){var t={tabular:[],chart:[],caption:"Activity count"};return e.length?(t.tabular=e,e=N()(e,0,10),t.chart=[{name:"Users",data:I()(e,function(e){return[e.name?e.name:e.id,e.count]})}],t):t}function p(t){e(".userdata").html(C()({rows:t.tabular,tableHeader:t.caption})),e(".report-list").DataTable({responsive:!0,lengthChange:!0,order:[[4,"desc"]]})}function f(){var t={report:J.tabular};e('form[name="export"] input[name="export"]').val(JSON.stringify(t))}Object.defineProperty(t,"__esModule",{value:!0});var m=s("./node_modules/highcharts/highcharts.js"),b=s.n(m),v=s("./node_modules/qs/lib/index.js"),g=s.n(v),y=s("./web/static/js/datePicker.js"),x=s("./node_modules/lodash/forEach.js"),w=s.n(x),j=s("./node_modules/lodash/reduce.js"),k=s.n(j),_=s("./node_modules/lodash/map.js"),I=s.n(_),S=s("./node_modules/lodash/slice.js"),N=s.n(S),U=s("./node_modules/lodash/indexOf.js"),D=s.n(U),T=(s("./web/static/js/common.js"),s("./node_modules/chosen-npm/public/chosen.jquery.js")),O=(s.n(T),s("./web/static/views/partials/default/tableUsers.hbs")),C=s.n(O),A=s("./node_modules/datatables.net-responsive-bs/js/responsive.bootstrap.js");s.n(A),s("./node_modules/highcharts/modules/exporting.js")(b.a),e('.chart-type > [data-toggle="tooltip"]').tooltip();var M=e("input[name=_csrf]").val(),q=g.a.parse(window.location.search.substring(1)),E=window.location.pathname.substring(1).split("/"),J={},B={bookDownloadComplete:{heading:"Top Users - Book Download",tooltip:"Top ten users who have downloaded the maximum number of books, and their download count"},bookOpen:{heading:"Top Users - Book Open",tooltip:"Top ten users who have opened the maximum number of books, and their book open count"},noteAdd:{heading:"Top Users - Notes",tooltip:"Top ten users who have created the maximum number of notes, and the count of notes created"},bookmarkAdd:{heading:"Top Users - Bookmarks",tooltip:"Top ten users who have created the maximum number of bookmarks, and the count of bookmarks created"},highlightAdd:{heading:"Top Users - Highlights",tooltip:"Top ten users who have created the maximum number of highlights, and the count of highlights created"},searchResult:{heading:"Top Users - Book Searches",tooltip:"Top ten users who have performed maximum number of searches, and count of searches performed"},activeUsers:{heading:"Active Users",tooltip:"Count of unique sessions for active users within the specified duration"},newUsers:{heading:"New Users",tooltip:"Count of unique sessions for any new user withing the specified duration"}};w()([".store-select-box",".select-box-large.institution",".select-box-large.event-type"],function(t){e(t).chosen({disable_search:!0})}),e(".store-select-box").chosen().change(function(){o()}),y.default.setDatePicker('input[name="daterange"]'),e(".user-activity-report .box-title").html(B[e(".select-box-large.event-type").chosen().val()].heading),e(".user-activity-report .box-title-help").attr("data-original-title",B[e(".select-box-large.event-type").chosen().val()].tooltip),e(".btnApply").on("click",function(){r(e(".store-select-box").chosen().val(),e(".select-box-large.event-type").chosen().val(),e(".select-box-large.institution").chosen().val())}),e(".chart-type button").on("click",function(){e(this).siblings().removeClass("active"),e(this).addClass("active"),u(J.chart,e(this).attr("name"))}),o(q.storeId),r(q.storeId,q.event,q.institutionIds,q.productIds),n(e(".select-box-large.filter-by").chosen().val(),e(".store-select-box").chosen().val(),q.filterVals),e(".select-box-large.filter-by").chosen().change(function(){n(e(this).val(),e(".store-select-box").chosen().val())})}).call(t,s("./node_modules/jquery/dist/jquery.js"))},"./web/static/views/partials/default/tableUsers.hbs":function(e,t,s){var n=s("./node_modules/handlebars/runtime.js");e.exports=(n.default||n).template({1:function(e,t,s,n,a){var o,i,r=null!=t?t:{},l=s.helperMissing,c="function",d=e.escapeExpression;return"            <tr>\n                <td>"+d((i=null!=(i=s.id||(null!=t?t.id:t))?i:l,typeof i===c?i.call(r,{name:"id",hash:{},data:a}):i))+"</td>\n                <td>"+d((i=null!=(i=s.name||(null!=t?t.name:t))?i:l,typeof i===c?i.call(r,{name:"name",hash:{},data:a}):i))+"</td>\n                <td>"+d((i=null!=(i=s.email||(null!=t?t.email:t))?i:l,typeof i===c?i.call(r,{name:"email",hash:{},data:a}):i))+"</td>\n                <td>"+d((i=null!=(i=s.institutionId||(null!=t?t.institutionId:t))?i:l,typeof i===c?i.call(r,{name:"institutionId",hash:{},data:a}):i))+"\n"+(null!=(o=s.if.call(r,null!=t?t.institutionName:t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?o:"")+"                </td>\n                <td>"+d((i=null!=(i=s.count||(null!=t?t.count:t))?i:l,typeof i===c?i.call(r,{name:"count",hash:{},data:a}):i))+"</td>\n            </tr>\n"},2:function(e,t,s,n,a){var o;return"                        - "+e.escapeExpression((o=null!=(o=s.institutionName||(null!=t?t.institutionName:t))?o:s.helperMissing,"function"==typeof o?o.call(null!=t?t:{},{name:"institutionName",hash:{},data:a}):o))+"\n"},compiler:[7,">= 4.0.0"],main:function(e,t,s,n,a){var o,i,r=null!=t?t:{};return'<table class="table table-bordered table-striped report-list">\n    <thead>\n        <th>Id</th>\n        <th>Name</th>\n        <th>Email</th>\n        <th>Institution</th>\n        <th>'+e.escapeExpression((i=null!=(i=s.tableHeader||(null!=t?t.tableHeader:t))?i:s.helperMissing,"function"==typeof i?i.call(r,{name:"tableHeader",hash:{},data:a}):i))+"</th>\n    </thead>\n    <tbody>\n"+(null!=(o=s.each.call(r,null!=t?t.rows:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"    </tbody>\n</table>\n"},useData:!0})}},["./web/static/js/userActivity.js"]);